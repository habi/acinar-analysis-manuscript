<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta name="author" content="David Haberthür" />
  <meta name="author" content="Eveline Yao" />
  <meta name="author" content="Sébastien F. Barré" />
  <meta name="author" content="Tiziana P. Cremona" />
  <meta name="author" content="Stefan A. Tschanz" />
  <meta name="author" content="Johannes C. Schittny" />
  <meta name="dcterms.date" content="2020-12-08" />
  <meta name="keywords" content="lung, acini, tomography" />
  <title>Pulmonary acini exhibit complex changes during postnatal rat lung development</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
  <!--
  Manubot generated metadata rendered from header-includes-template.html.
  Suggest improvements at https://github.com/manubot/manubot/blob/master/manubot/process/header-includes-template.html
  -->
  <meta name="dc.format" content="text/html" />
  <meta name="dc.title" content="Pulmonary acini exhibit complex changes during postnatal rat lung development" />
  <meta name="citation_title" content="Pulmonary acini exhibit complex changes during postnatal rat lung development" />
  <meta property="og:title" content="Pulmonary acini exhibit complex changes during postnatal rat lung development" />
  <meta property="twitter:title" content="Pulmonary acini exhibit complex changes during postnatal rat lung development" />
  <meta name="dc.date" content="2020-12-08" />
  <meta name="citation_publication_date" content="2020-12-08" />
  <meta name="dc.language" content="en-US" />
  <meta name="citation_language" content="en-US" />
  <meta name="dc.relation.ispartof" content="Manubot" />
  <meta name="dc.publisher" content="Manubot" />
  <meta name="citation_journal_title" content="Manubot" />
  <meta name="citation_technical_report_institution" content="Manubot" />
  <meta name="citation_author" content="David Haberthür" />
  <meta name="citation_author_institution" content="Institute of Anatomy, University of Bern, Switzerland" />
  <meta name="citation_author_orcid" content="0000-0003-3388-9187" />
  <meta name="twitter:creator" content="@habi" />
  <meta name="citation_author" content="Eveline Yao" />
  <meta name="citation_author_institution" content="Institute of Anatomy, University of Bern, Switzerland" />
  <meta name="citation_author" content="Sébastien F. Barré" />
  <meta name="citation_author_institution" content="Institute of Anatomy, University of Bern, Switzerland" />
  <meta name="citation_author" content="Tiziana P. Cremona" />
  <meta name="citation_author_institution" content="Institute of Anatomy, University of Bern, Switzerland" />
  <meta name="citation_author_orcid" content="0000-0003-0061-9578" />
  <meta name="citation_author" content="Stefan A. Tschanz" />
  <meta name="citation_author_institution" content="Institute of Anatomy, University of Bern, Switzerland" />
  <meta name="citation_author_orcid" content="0000-0003-3880-4437" />
  <meta name="citation_author" content="Johannes C. Schittny" />
  <meta name="citation_author_institution" content="Institute of Anatomy, University of Bern, Switzerland" />
  <meta name="citation_author_orcid" content="0000-0003-4025-3961" />
  <link rel="canonical" href="https://habi.github.io/acinar-analysis-manuscript/" />
  <meta property="og:url" content="https://habi.github.io/acinar-analysis-manuscript/" />
  <meta property="twitter:url" content="https://habi.github.io/acinar-analysis-manuscript/" />
  <meta name="citation_fulltext_html_url" content="https://habi.github.io/acinar-analysis-manuscript/" />
  <meta name="citation_pdf_url" content="https://habi.github.io/acinar-analysis-manuscript/manuscript.pdf" />
  <link rel="alternate" type="application/pdf" href="https://habi.github.io/acinar-analysis-manuscript/manuscript.pdf" />
  <link rel="alternate" type="text/html" href="https://habi.github.io/acinar-analysis-manuscript/v/9d5c623b3eefb444db71bb9adfe13d2531bc9516/" />
  <meta name="manubot_html_url_versioned" content="https://habi.github.io/acinar-analysis-manuscript/v/9d5c623b3eefb444db71bb9adfe13d2531bc9516/" />
  <meta name="manubot_pdf_url_versioned" content="https://habi.github.io/acinar-analysis-manuscript/v/9d5c623b3eefb444db71bb9adfe13d2531bc9516/manuscript.pdf" />
  <meta property="og:type" content="article" />
  <meta property="twitter:card" content="summary_large_image" />
  <link rel="icon" type="image/png" sizes="192x192" href="https://manubot.org/favicon-192x192.png" />
  <link rel="mask-icon" href="https://manubot.org/safari-pinned-tab.svg" color="#ad1457" />
  <meta name="theme-color" content="#ad1457" />
  <!-- end Manubot generated metadata -->
</head>
<body>
<header id="title-block-header">
<h1 class="title">Pulmonary acini exhibit complex changes during postnatal rat lung development</h1>
</header>
<p>A preprint of this manuscript is available on <em>bioRxiv</em> at <a href="https://doi.org/10.1101/786681" class="uri">https://doi.org/10.1101/786681</a> and has been submitted to the <a href="https://journals.physiology.org/journal/ajplung"><em>American Journal of Physiology - Lung Cellular and Molecular Physiology</em></a>.</p>
<p>This version of the manuscript <a href="https://github.com/habi/acinar-analysis-manuscript/compare/d6fc17bd66bdca5cbff30d53e1dbc02d5351609b...9d5c623b3eefb444db71bb9adfe13d2531bc9516">has been updated</a> since the first round of review.</p>
<p><small><em>
This manuscript
(<a href="https://habi.github.io/acinar-analysis-manuscript/v/9d5c623b3eefb444db71bb9adfe13d2531bc9516/">permalink</a>)
was automatically generated
from <a href="https://github.com/habi/acinar-analysis-manuscript/tree/9d5c623b3eefb444db71bb9adfe13d2531bc9516">habi/acinar-analysis-manuscript@9d5c623</a>
on December 8, 2020.
</em></small></p>
<h2 id="authors">Authors</h2>
<ul>
<li><p><strong>David Haberthür</strong><sup></sup>
· <img src="images/orcid.svg" class="inline_icon" alt="ORCID icon" />
<a href="https://orcid.org/0000-0003-3388-9187">0000-0003-3388-9187</a>
· <img src="images/github.svg" class="inline_icon" alt="GitHub icon" />
<a href="https://github.com/habi">habi</a>
· <img src="images/twitter.svg" class="inline_icon" alt="Twitter icon" />
<a href="https://twitter.com/habi">habi</a><br>
<small>
Institute of Anatomy, University of Bern, Switzerland
</small></p></li>
<li><p><strong>Eveline Yao</strong><sup></sup><br>
<small>
Institute of Anatomy, University of Bern, Switzerland
</small></p></li>
<li><p><strong>Sébastien F. Barré</strong><sup></sup><br>
<small>
Institute of Anatomy, University of Bern, Switzerland
</small></p></li>
<li><p><strong>Tiziana P. Cremona</strong><sup></sup>
· <img src="images/orcid.svg" class="inline_icon" alt="ORCID icon" />
<a href="https://orcid.org/0000-0003-0061-9578">0000-0003-0061-9578</a><br>
<small>
Institute of Anatomy, University of Bern, Switzerland
</small></p></li>
<li><p><strong>Stefan A. Tschanz</strong><sup></sup>
· <img src="images/orcid.svg" class="inline_icon" alt="ORCID icon" />
<a href="https://orcid.org/0000-0003-3880-4437">0000-0003-3880-4437</a><br>
<small>
Institute of Anatomy, University of Bern, Switzerland
</small></p></li>
<li><p><strong>Johannes C. Schittny</strong><sup>✉</sup>
· <img src="images/orcid.svg" class="inline_icon" alt="ORCID icon" />
<a href="https://orcid.org/0000-0003-4025-3961">0000-0003-4025-3961</a><br>
<small>
Institute of Anatomy, University of Bern, Switzerland
</small></p></li>
</ul>
<p><sup>✉</sup>: Corresponding author. Correspondence preferred via <a href="https://github.com/habi/acinar-analysis-manuscript/issues">GitHub Issues</a>, though.</p>
<h2 class="page_break_before" id="abstract">Abstract</h2>
<p>Pulmonary acini represent the functional gas-exchanging units of the lung.
Due to technical limitations, individual acini cannot be identified on microscopic lung sections.
To overcome these limitations, we imaged the right lower lobes of instillation-fixed rat lungs from postnatal days P4, P10, P21, and P60 at the TOMCAT beamline of the Swiss Light Source synchrotron facility at a voxel size of 1.48 μm.
Individual acini were segmented from the three-dimensional data by closing the airways at the transition from conducting to gas exchanging airways.
For a subset of acini (N=268), we followed the acinar development by stereologically assessing their volume and their number of alveoli.
We found that the mean volume of the acini increases 23 times during the observed time-frame.
The coefficients of variation dropped from 1.26 to 0.49 and the difference between the mean volumes of the fraction of the 20 % smallest to the 20 % largest acini decreased from a factor of 27.26 (day 4) to a factor of 4.07 (day 60), i.e. shows a smaller dispersion at later time points.
The acinar volumes show a very large variation early in lung development and homogenize during maturation of the lung by reducing their size distribution by a factor of 7 until adulthood.
The homogenization of the acinar sizes hints at an optimization of the gas-exchange region in the lungs of adult animals and that acini of different size are not evenly distributed in the lungs.
This likely leads to more homogeneous ventilation at later stages in lung development.</p>
<h2 id="introduction">Introduction</h2>
<h3 id="lung-development">Lung development</h3>
<p>Lung development starts with the formation of the two lung buds.
During the embryonic stage (prenatal days E11–E13 in rats) the major airways and the pleura are formed.
During the pseudoglandular stage (E13–E18.5) most of the remaining airway generations are formed by branching morphogenesis.
Only few additional branches are added during the later stages (canalicular (E18.5–E20) and (E20 to postnatal day P4)) <span class="citation" data-cites="TsNwin2E">(<a href="#ref-TsNwin2E" role="doc-biblioref">34</a>)</span>.
Epithelial differentiation during the canalicular stage and angiogenetic activation of the capillaries lead to the first functional air-blood barriers in the lung <span class="citation" data-cites="ODQCVC23">(<a href="#ref-ODQCVC23" role="doc-biblioref">33</a>)</span>.
The saccular stage represents an intermediate stage where branching morphogenesis ceases and the developmental program switches to the phase of alveolarization.
During alveolarization, 90 % of the adult gas-exchange area is formed by lifting off new septa from the existing gas-exchange surface <span class="citation" data-cites="auNiE56G 1AhvLCPky XQLPrPTJ">(<a href="#ref-auNiE56G" role="doc-biblioref">5</a>, <a href="#ref-1AhvLCPky" role="doc-biblioref">19</a>, <a href="#ref-XQLPrPTJ" role="doc-biblioref">32</a>)</span>.
Alveolarization itself is divided into two distinct phases, the so-called classical (P4–P21) and continued alveolarization (P14 to approximately P60) <span class="citation" data-cites="wnl86DEM d1YV8oOK">(<a href="#ref-d1YV8oOK" role="doc-biblioref">35</a>, <a href="#ref-wnl86DEM" role="doc-biblioref">46</a>)</span>.
During classical alveolarization, new septa are formed starting from preexisting immature septa which contain a double-layered capillary network.
During continued alveolarization, new septa are formed from preexisting mature septa.
In general, during alveolarization the structure of the alveolar septa is changed to increase the efficiency of the lung <span class="citation" data-cites="wnl86DEM d1YV8oOK">(<a href="#ref-d1YV8oOK" role="doc-biblioref">35</a>, <a href="#ref-wnl86DEM" role="doc-biblioref">46</a>)</span>.</p>
<p>In this manuscript, the timing of lung development is given for rats while the same stages and developmental mechanisms are observed in every placentalian species studied so far, including humans.
However, the timing of lung development and especially the time point of birth relative to lung development is adapted in each species <span class="citation" data-cites="XQLPrPTJ ODQCVC23 d1YV8oOK">(<a href="#ref-XQLPrPTJ" role="doc-biblioref">32</a>, <a href="#ref-ODQCVC23" role="doc-biblioref">33</a>, <a href="#ref-d1YV8oOK" role="doc-biblioref">35</a>)</span>.</p>
<h3 id="the-functional-lung-units">The functional lung units</h3>
<p>Pulmonary acini represent the gas-exchanging units of the bronchial tree and are defined as the airways distal of the terminal bronchioles <span class="citation" data-cites="BbEFwEVD">(<a href="#ref-BbEFwEVD" role="doc-biblioref">13</a>)</span>.
In humans, the acini contain approximately four generations of respiratory bronchioles before reaching the alveolar ducts.
The alveolar ducts start at the so-called bronchioalveolar duct junction (BADJ) where the lining of the inner airway surface abruptly changes from the cuboidal epithelium of the bronchioles into type 1 and type 2 alveolar epithelium which covers the alveoli.
The small tree of airways distal of the BADJ is called a ventilatory unit <span class="citation" data-cites="WDrIHn9p">(<a href="#ref-WDrIHn9p" role="doc-biblioref">39</a>)</span>.
Since murine lungs do not possess respiratory bronchioles, the murine acini consist of one single ventilatory unit <span class="citation" data-cites="WDrIHn9p">(<a href="#ref-WDrIHn9p" role="doc-biblioref">39</a>)</span>.
In this study we used rat lungs; hence we exclusively speak of acini.
To translate our results from rats to humans, monkeys, or dogs one would have to compare one rat acinus to one single ventilatory unit in these species.</p>
<p>Developmentally, the BADJ is of particular interest.
The junction is formed during the canalicular stage when the epithelia are differentiating.
The generation of the airway in which an individual murine acinus starts is defined during the canalicular stage and remains constant once it is formed.
As a consequence, in rats the number of formed acini also remains constant during the phase of alveolarization and thereafter <span class="citation" data-cites="14OP85b2F uFNlWogb">(<a href="#ref-14OP85b2F" role="doc-biblioref">2</a>, <a href="#ref-uFNlWogb" role="doc-biblioref">3</a>)</span>.
The latter was somehow surprising because in rats the total lung volume increases by roughly a factor of 10 during alveolarization <span class="citation" data-cites="wnl86DEM">(<a href="#ref-wnl86DEM" role="doc-biblioref">46</a>)</span>.
Therefore, the mean volume of the acini has to increase by approximately the same factor.</p>
<p>The acinar architecture is important for ventilation, airflow <span class="citation" data-cites="CVl41LwO eb0gk6VO 1DP2FRUSZ">(<a href="#ref-CVl41LwO" role="doc-biblioref">8</a>, <a href="#ref-eb0gk6VO" role="doc-biblioref">14</a>, <a href="#ref-1DP2FRUSZ" role="doc-biblioref">16</a>)</span> and particle deposition <span class="citation" data-cites="yHHhvOtP 18DcNLAv6 wnl86DEM">(<a href="#ref-18DcNLAv6" role="doc-biblioref">22</a>, <a href="#ref-yHHhvOtP" role="doc-biblioref">36</a>, <a href="#ref-wnl86DEM" role="doc-biblioref">46</a>)</span>.</p>
<h3 id="acinus-detection-and-delineation">Acinus detection and delineation</h3>
<p>On single two-dimensional sections—either histological or virtual from tomographic imaging—it is not possible to unambiguously detect which parts of the airways and alveoli are connected three-dimensionally.
To detect and delineate individual acini the full three-dimensional information is needed.
Historically, single or very few acini were delineated and extracted from manually traced serial sections <span class="citation" data-cites="c3aIB7f9 CPhMy3Ie">(<a href="#ref-c3aIB7f9" role="doc-biblioref">28</a>, <a href="#ref-CPhMy3Ie" role="doc-biblioref">50</a>)</span> or sectioned silicone casts <span class="citation" data-cites="1GJECnKBu">(<a href="#ref-1GJECnKBu" role="doc-biblioref">30</a>)</span> with considerable manual work.
Non-destructive three-dimensional imaging is best suited to acquire data sets that can be used to easily detect, delineate, and study large amounts of single acini.
This has been shown by Vasilescu et al. <span class="citation" data-cites="C6OaY84D">(<a href="#ref-C6OaY84D" role="doc-biblioref">48</a>)</span>.
In their study, they reconstructed 22 mouse acini from tomographic data sets of four 12 weeks old mice (at least postnatal day 84, fully developed lungs) and compared those with scanning electron microscope images of acinar silicone rubber casts.
Similarly, Kizhakke Puliyakote et al. <span class="citation" data-cites="RGBeCf8v">(<a href="#ref-RGBeCf8v" role="doc-biblioref">20</a>)</span> analyzed the volume of 32 mouse acini from six animals, as well as the branching pattern of their internal airways.
All prior work known to us has analyzed considerably fewer acini than the 268 acini presented here and focuses only on a time point, at which the lungs of the animals are already fully developed while our data spans the postnatal days 4 to 60.</p>
<h3 id="aims-of-this-study">Aims of this study</h3>
<h4 id="acinar-structure">Acinar structure</h4>
<p>Due to the lack of precise and complete three-dimensional data, simulations of airflow in the lung are based on relatively simple acinar models.
The question of how well these models represent lung physiology remains open until the necessary data and physiologically correct models are available.
To contribute to the validation of the computational fluid dynamics simulations, we extracted individual acini and determined their volume and their number of alveoli throughout rat lung development.</p>
<h4 id="individual-acinar-volumes">Individual acinar volumes</h4>
<p>While the global volume of the acini is well known and studied, only little is known about the range of the volume of individual acini throughout lung development.
We developed the hereby presented method to analyze large amounts of acini over the course of postnatal lung development in a time-efficient manner since no data on large amounts of acini is available up to now.
Our aim was to understand the size distribution of the acini during lung development including the contribution of the alveoli.
The observed range <em>de</em>creased during postnatal lung development by a factor of 6–7, which represents a completely unexpected result.
The obtained data are essential for further investigations, like the influence of the size of the acini on ventilation or gas-washout, respectively.
E.g., we are currently using our computational fluid dynamics model to simulate exactly this influence (own unpublished results and <span class="citation" data-cites="eb0gk6VO">(<a href="#ref-eb0gk6VO" role="doc-biblioref">14</a>)</span>).</p>
<h2 id="materials-methods">Materials &amp; Methods</h2>
<h3 id="rat-lung-samples">Rat lung samples</h3>
<p>In the present study, a superset of the animals described by Haberthür et al. <span class="citation" data-cites="7YLeeyu">(<a href="#ref-7YLeeyu" role="doc-biblioref">11</a>)</span> were used.
Tschanz et al. <span class="citation" data-cites="wnl86DEM">(<a href="#ref-wnl86DEM" role="doc-biblioref">46</a>)</span> described a biphasic formation of new alveoli on the same set of animals.
The stereological analysis presented here represents a part of the 3R-initiative (replacement, reduction, and refinement) <span class="citation" data-cites="199ALtdJt">(<a href="#ref-199ALtdJt" role="doc-biblioref">53</a>)</span> for the ethical use and the reduction of the number of animals sacrificed for science.</p>
<p>Briefly, we extracted the lungs of Sprague-Dawley rats after having deeply anesthetized them with a mixture of medetomidine, midazolam, and fentanyl <span class="citation" data-cites="IdRLVLjl">(<a href="#ref-IdRLVLjl" role="doc-biblioref">7</a>)</span>.
The rats were euthanized by exsanguination during the removal of the lung.
The lungs were fixed with 2.5 % glutaraldehyde by intratracheal instillation and kept under constant pressure (20 cm H<sub>2</sub>O) during fixation to prevent recoiling of the tissue.
The samples were prepared for tomographic imaging by post-fixation with 1 % osmium tetroxide and staining with 4 % uranyl acetate, as well as by dehydration in a graded series of ethanol and embedding in paraffin.
In total we assessed 12 animals, on postnatal days P4, P10, P21, and P60 (N=3 per day.
From now on, we will omit the postnatal prefix and only mention the day.).</p>
<p>The animals were housed in the central animal facility of the University of Bern.
They received food and water ad libitum at a 12/12 hours day/night cycle.
The experiments themselves, as well as the handling of the animals before and during the experiments, were approved and supervised by the Federal Food Safety and Veterinary Office of Switzerland and the Department of Agriculture and Nature of the Kanton of Bern in Switzerland.</p>
<h3 id="tomographic-imaging">Tomographic imaging</h3>
<p>Tomographic imaging was performed at the <a href="https://www.psi.ch/sls/tomcat/">TOMCAT</a> beamline (A beamline for TOmographic Microscopy and Coherent rAdiology experimenTs) <span class="citation" data-cites="knMAkPPz Cp0VRmEj">(<a href="#ref-knMAkPPz" role="doc-biblioref">26</a>, <a href="#ref-Cp0VRmEj" role="doc-biblioref">27</a>)</span> of the <a href="https://www.psi.ch/sls/">Swiss Light Source</a> at the <a href="https://www.psi.ch/">Paul Scherrer Institute</a> in Villigen, Switzerland.
The samples were scanned at an X-ray energy of 20.0 keV.
After penetrating the sample, the X-rays were converted into visible light by either a 20 μm-thick LuAG:Ce or 18 μm-thick YAG:Ce scintillator screen (both from <a href="http://www.crytur.cz/">Crytur</a>, Turnov, Czech Republic), depending on the date of experiments.
The resulting visible light was magnified using a 10-times magnifying, diffraction-limited microscope lens and recorded with a 2048 × 2048 pixel CCD camera (<a href="https://www.pco.de/specialized-cameras/pco2000/">pco.2000</a>, PCO, Kelheim, Germany) with 14 bits dynamic range operated in 2 by 2 binning mode.
As a result, in a single field of view, we were able to image a sample volume of a cube of 1.5 mm side length with a voxel side length of 1.48 μm, with the exposure time of the single projections varying between 160 and 200 ms.</p>
<p>Since our samples were substantially larger than the field of view of the detector, we applied the so-called wide-field scanning method <span class="citation" data-cites="VELl7OiR">(<a href="#ref-VELl7OiR" role="doc-biblioref">12</a>)</span> to increase the field of view horizontally.
For each sub-scan, we recorded 3578 projections and laterally stitched them so that their combined field of view covered the whole sample width.
Additionally, two or three such wide-field scans were stacked vertically to match the sample height.</p>
<p>The resulting data sets for each of the lung samples covered a field of view of a cube with approximately 4.5 mm side length which corresponds to an image stack with approximately 3000 × 3000 × 3000 pixels at 1.48 μm side length each.
The mean size of the tomographic reconstructions, corresponding to the raw data of each of the 42 analyzed tomographic scans is 8 GB, totaling to 336 GB.</p>
<h3 id="extraction-of-acini">Extraction of acini</h3>
<p>For the present manuscript, we extracted single acini from three-dimensional data, acquired without destroying the samples.
Details of this semi-automatic extraction of the rat acini are described by Haberthür et al. <span class="citation" data-cites="7YLeeyu">(<a href="#ref-7YLeeyu" role="doc-biblioref">11</a>)</span>.
Individual acini were extracted from the tomographic data with a custom image processing network established in <a href="https://www.mevislab.de/">MeVisLab</a> (version 2.1, 2010-07-26 release, MeVis Medical Solutions and Fraunhofer MEVIS-Institute for Medical Image Computing, Bremen, Germany).
To isolate individual acini, we followed the airway tree in the data and manually placed disk-shaped segmentation stoppers at the acinus entrances.
Thus, acini were selected independently of their size and only based on their location in the airway tree, are not selected based on their size.
The acinus extraction was performed by segmenting the acinus volume with a gray-level threshold-based region growing algorithm with a seed point perpendicular to the manually placed segmentation stopper.
Each individual acinus was then exported as a single DICOM file for portability.
For each acinus, its exported DICOM file contained the segmented acinus overlaid with the original background for further analysis.
Example images from the DICOM files are shown in the bottom row of figure <a href="#fig:01">1</a>.</p>
<p>This semi-automatic acinus segmentation method was applied to lung samples obtained throughout lung development, at postnatal days 4, 10, 21 and 60.
In total we extracted 701 acini from 12 animals, a breakdown of the number of extracted and assessed acini per animal is given in <a href="#tbl:counts">1</a>.
Even if our method is efficient, we could not have stereologically assessed all these 701 acini, we thus performed a subsampling and stereologically analyzed 268 acini, as specified in the section below.</p>
<h3 id="stereological-analysis-of-alveolar-characteristics">Stereological analysis of alveolar characteristics</h3>
<p>The stereological estimation of the alveolar number was performed according to the standards for quantitative assessment of lung structure from the <a href="http://www.thoracic.org/">American Thoracic Society</a> <span class="citation" data-cites="dNc8FfNn">(<a href="#ref-dNc8FfNn" role="doc-biblioref">17</a>)</span> to guarantee accurate and unbiased results.
As a basis for the estimation the volumes of the lung lobes were first determined by water displacement <span class="citation" data-cites="KGbSQovR">(<a href="#ref-KGbSQovR" role="doc-biblioref">31</a>)</span>.
The lobe-volume was estimated a second time by the Cavalieri method.
Both volumes were used to calculate the shrinkage, which was used for the correction of the volume data <span class="citation" data-cites="wnl86DEM">(<a href="#ref-wnl86DEM" role="doc-biblioref">46</a>)</span>.</p>
<p>To perform the stereological analysis, each DICOM file from the isolated acini was sampled into a systematic random set of single images using a MATLAB script <span class="citation" data-cites="12Z2YPzm8">(<a href="#ref-12Z2YPzm8" role="doc-biblioref">10</a>)</span>.
The stereological assessment was performed with the <a href="http://stepanizer.com/">STEPanizer</a> <span class="citation" data-cites="nPoQ2EIB">(<a href="#ref-nPoQ2EIB" role="doc-biblioref">45</a>)</span>, an easy-to-use software tool for the stereological assessment of digital images.
Details of the stereological assessment have previously been described <span class="citation" data-cites="7YLeeyu">(<a href="#ref-7YLeeyu" role="doc-biblioref">11</a>)</span>.
Briefly, we counted the appearance or disappearance of alveolar wall interruptions.
Under the assumption that these only occur in the region of the alveolar mouth opening and correspond to alveolar entrance rings <span class="citation" data-cites="QiAxY2i3">(<a href="#ref-QiAxY2i3" role="doc-biblioref">18</a>)</span> we counted said interruptions on paired images spanning the whole acinus volume.
By using the disector method <span class="citation" data-cites="FJ9FoB4m">(<a href="#ref-FJ9FoB4m" role="doc-biblioref">38</a>)</span> we were thus able to estimate the number of alveoli in 268 of the 701 exported acini.
The acini we analyzed were subsampled from the full data by systematic uniform random sampling <span class="citation" data-cites="dNc8FfNn">(<a href="#ref-dNc8FfNn" role="doc-biblioref">17</a>)</span>.
Briefly, a defined fraction of the acini of one animal were analyzed, e.g. one third.
During segmentation, the acini were numbered.
Based on these numbers every third acinus was selected, randomly starting with the first, second, or third one.</p>
<p>Previously, we have shown that the stereological assessment of the acinar volume (according to the Cavalieri principle <span class="citation" data-cites="FE9HLB4f">(<a href="#ref-FE9HLB4f" role="doc-biblioref">6</a>)</span>) gives comparable results to an automated volume extraction by counting the segmented pixels in the tomographic data sets <span class="citation" data-cites="7YLeeyu">(<a href="#ref-7YLeeyu" role="doc-biblioref">11</a>)</span>.
Due to variations in the gray value, the automatic segmentation underestimates the volume of the single acini.
The best-suited approach to obtain unbiased results is to assess the volume manually according to the Cavalieri principle, which is what we did for the 268 acini presented in this manuscript.
The sets of JPG slices and the raw results from the stereological analysis with the STEPanizer are available on request.</p>
<h3 id="data-analysis-and-display">Data analysis and display</h3>
<p>All the stereologically assessed data was processed in a <a href="http://jupyter.org/">Jupyter</a> <span class="citation" data-cites="pQ6Wbz73">(<a href="#ref-pQ6Wbz73" role="doc-biblioref">21</a>)</span> notebook, producing all the results, including the statistical data and plots shown below.
The notebook with all its history is freely available on GitHub <span class="citation" data-cites="V87xbt0b">(<a href="#ref-V87xbt0b" role="doc-biblioref">9</a>)</span>.
The performed calculations are described in detail in the <a href="#results">Results</a> section.
In the plots, semitransparent circles mark the single observations.
The box shows the 25 %–75 % quartiles range of the data.
The whiskers extend to the rest of the distribution.
Outliers are determined as a function of the inter-quartile range and are shown outside the whiskers.
Numerical values in the text are given as averages ± standard deviation.
P-values in the text and figure legends are given as precise numbers, as suggested by Amhrein et al. <span class="citation" data-cites="o21zxPIu">(<a href="#ref-o21zxPIu" role="doc-biblioref">1</a>)</span>.</p>
<p>Usually, we performed a Shapiro-Wilk test for normality <span class="citation" data-cites="IkHrgIj3">(<a href="#ref-IkHrgIj3" role="doc-biblioref">37</a>)</span> to test whether we can use an U-test for assessing the differences, namely a two-sided Mann-Whitney rank test <span class="citation" data-cites="MyzxBJ57">(<a href="#ref-MyzxBJ57" role="doc-biblioref">25</a>)</span>.
This rank test was used to assess the differences between the possible combinations.
An additional Kruskal-Wallis H-test for independent samples <span class="citation" data-cites="ON1Bppkk">(<a href="#ref-ON1Bppkk" role="doc-biblioref">23</a>)</span> was used to test for sample independence.
The statistical analysis was performed in the aforementioned notebook by using the statistical functions of the Scientific Computing Tools for Python <span class="citation" data-cites="8Miti2Gz">(<a href="#ref-8Miti2Gz" role="doc-biblioref">49</a>)</span> or GraphPad Prism 7.01 (GraphPad Software, San Diego, CA, USA).</p>
<h2 id="results">Results</h2>
<p>The number of alveoli per acinus was assessed for 268 individual acini at days 4, 10, 21 and 60.
For day 4, we analyzed 125 acini, for day 10 we analyzed 58 acini, for day 21 we analyzed 42 acini, and for day 60 we analyzed 43 acini.</p>
<p>An overview of our process is shown in figure <a href="#fig:01">1</a>.
Panels A–D depict a representative light microscopy image for each assessed time point.
Panels E–H of figure <a href="#fig:01">1</a> each correspond to one slice of the tomographic data sets acquired at TOMCAT.
Panels I–L of figure <a href="#fig:01">1</a> show the middle slice of the datasets used for the stereological analysis of the extracted acini.
The acinus is shown in light gray as an overlay over the tomographic data.</p>
<div id="fig:01" class="fignos">
<figure>
<img src="images/fig01.png" alt="" /><figcaption><span>Figure 1:</span> Example images for each of the assessed time points.
A–D: Representative light microscopy images.
E–H: One slice of the tomographic data sets.
I–L: Middle slice of one of the extracted acini.
The extracted acinus is overlaid on the tomographic dataset.
Panels J and K also show the segmentation stopper at the left border of the image.
The shown images correspond to the middle slice of the full data sets used for the stereological analysis.
The scale bar was burnt in during preparation of the image stacks and is 100 μm long.
Panels A, E &amp; I: Day 4.
Panels B, F &amp; J: Day 10.
Panels C, G &amp; K: Day 21.
Panels D, H &amp; L: Day 60.</figcaption>
</figure>
</div>
<h3 id="alveoli-per-acinus">Alveoli per acinus</h3>
<p>The average entrance ring count, which corresponds to the number of alveoli per acinus for the 125 acini at day 4 is 48 ± 41 alveoli.
For the 58 acini at day 10 it is 89 ± 84 alveoli, for the 42 acini at day 21 it is 233 ± 164 alveoli.
At day 60 we assessed 43 acini in total, on average they have 702 ± 219 alveoli.</p>
<p>The values for the single animal are given in table <a href="#tbl:counts">1</a> and plotted in figure <a href="#fig:02">2</a>.</p>
<div id="tbl:counts" class="tablenos">
<table>
<caption><span>Table 1:</span> Detailed alveolar numbers for each animal. </caption>
<thead>
<tr class="header">
<th>Animal</th>
<th>Assessed acini</th>
<th>Average counts</th>
<th>STD</th>
<th>Minimum</th>
<th>Maximum</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>04A</td>
<td>51</td>
<td>26.73</td>
<td>23.56</td>
<td>4</td>
<td>111</td>
</tr>
<tr class="even">
<td>04B</td>
<td>23</td>
<td>65.04</td>
<td>43.85</td>
<td>15</td>
<td>171</td>
</tr>
<tr class="odd">
<td>04C</td>
<td>51</td>
<td>60.51</td>
<td>45.42</td>
<td>10</td>
<td>249</td>
</tr>
<tr class="even">
<td>10A</td>
<td>27</td>
<td>77.85</td>
<td>56.31</td>
<td>18</td>
<td>245</td>
</tr>
<tr class="odd">
<td>10B</td>
<td>14</td>
<td>84.57</td>
<td>65.75</td>
<td>23</td>
<td>199</td>
</tr>
<tr class="even">
<td>10C</td>
<td>17</td>
<td>108.76</td>
<td>125.45</td>
<td>15</td>
<td>505</td>
</tr>
<tr class="odd">
<td>21B</td>
<td>14</td>
<td>208.14</td>
<td>197.71</td>
<td>35</td>
<td>781</td>
</tr>
<tr class="even">
<td>21D</td>
<td>17</td>
<td>196.00</td>
<td>128.56</td>
<td>50</td>
<td>493</td>
</tr>
<tr class="odd">
<td>21E</td>
<td>11</td>
<td>323.09</td>
<td>145.94</td>
<td>108</td>
<td>572</td>
</tr>
<tr class="even">
<td>60B</td>
<td>24</td>
<td>701.75</td>
<td>230.95</td>
<td>322</td>
<td>1296</td>
</tr>
<tr class="odd">
<td>60D</td>
<td>10</td>
<td>668.30</td>
<td>121.67</td>
<td>444</td>
<td>810</td>
</tr>
<tr class="even">
<td>60E</td>
<td>9</td>
<td>739.11</td>
<td>281.22</td>
<td>272</td>
<td>1204</td>
</tr>
</tbody>
</table>
</div>
<div id="fig:02" class="fignos">
<figure>
<img src="images/fig02.png" alt="" /><figcaption><span>Figure 2:</span> Distribution of the number of alveoli per acinus (entrance ring count per acinus) for each animal.
Left: linear scale, right: logarithmic scale.
The entrance ring counts per day are all significantly different (all p-values better than 1.9e-5, which is the one between days 4 and 10).</figcaption>
</figure>
</div>
<p>The alveolar number shows highly significant differences Šidák-corrected p-value &lt; 0.00167 <span class="citation" data-cites="GtCynqsI">(<a href="#ref-GtCynqsI" role="doc-biblioref">44</a>)</span>) between all possible combination of days.
All possible combinations of entrance ring counts per day are significantly different (all p-values are better than p=1.9e-5, which is the p-value of the difference between days 4 and 10).
The entrance ring counts for all animals are independent (p=1.6e-34).</p>
<h3 id="acinus-volume">Acinus volume</h3>
<p>The stereological assessment resulted in a mean acinar volume of 0.03 ± 0.04 mm<sup>3</sup> for the 125 acini at day 4.
For the 58 acini at day 10 we get a volume of 0.04 ± 0.05 mm<sup>3</sup>.
For the 42 acini at day 21 a volume of 0.10 ± 0.09 mm<sup>3</sup> and for the 43 acini at day 60 a volume of 0.74 ± 0.37 mm<sup>3</sup>.</p>
<p>The values for the single animals are shown in table <a href="#tbl:volumes">2</a> and displayed in figure <a href="#fig:03">3</a>.</p>
<div id="tbl:volumes" class="tablenos">
<table>
<caption><span>Table 2:</span> Detailed volume data (in mm<sup>3</sup>) for each animal. </caption>
<thead>
<tr class="header">
<th>Animal</th>
<th>Assessed acini</th>
<th>Average [mm<sup>3</sup>]</th>
<th>STD [mm<sup>3</sup>]</th>
<th>Minimum [mm<sup>3</sup>]</th>
<th>Maximum [mm<sup>3</sup>]</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>04A</td>
<td>51</td>
<td>0.009</td>
<td>0.008</td>
<td>0.002</td>
<td>0.035</td>
</tr>
<tr class="even">
<td>04B</td>
<td>23</td>
<td>0.058</td>
<td>0.053</td>
<td>0.008</td>
<td>0.194</td>
</tr>
<tr class="odd">
<td>04C</td>
<td>51</td>
<td>0.044</td>
<td>0.044</td>
<td>0.006</td>
<td>0.275</td>
</tr>
<tr class="even">
<td>10A</td>
<td>27</td>
<td>0.033</td>
<td>0.026</td>
<td>0.004</td>
<td>0.108</td>
</tr>
<tr class="odd">
<td>10B</td>
<td>14</td>
<td>0.033</td>
<td>0.030</td>
<td>0.004</td>
<td>0.096</td>
</tr>
<tr class="even">
<td>10C</td>
<td>17</td>
<td>0.057</td>
<td>0.084</td>
<td>0.002</td>
<td>0.333</td>
</tr>
<tr class="odd">
<td>21B</td>
<td>14</td>
<td>0.087</td>
<td>0.086</td>
<td>0.011</td>
<td>0.322</td>
</tr>
<tr class="even">
<td>21D</td>
<td>17</td>
<td>0.109</td>
<td>0.112</td>
<td>0.014</td>
<td>0.380</td>
</tr>
<tr class="odd">
<td>21E</td>
<td>11</td>
<td>0.118</td>
<td>0.072</td>
<td>0.025</td>
<td>0.238</td>
</tr>
<tr class="even">
<td>60B</td>
<td>24</td>
<td>0.588</td>
<td>0.223</td>
<td>0.226</td>
<td>1.104</td>
</tr>
<tr class="odd">
<td>60D</td>
<td>10</td>
<td>0.888</td>
<td>0.350</td>
<td>0.364</td>
<td>1.576</td>
</tr>
<tr class="even">
<td>60E</td>
<td>9</td>
<td>0.977</td>
<td>0.526</td>
<td>0.186</td>
<td>1.875</td>
</tr>
</tbody>
</table>
</div>
<p>The mean volume of the 20 % smallest acini to the 20 % largest acini at day 4 differs by a factor of 27.47 (from 0.0035 μl–0.095 μl, N=25).
At day 10, this increase is 15.28 times (from 0.0071 μl–0.11 μl, N=12).
At day 21, this increase is 14.42 times (from 0.018 μl–0.26 μl, N=8).
At day 60, we saw an increase of 3.94 times (from 0.33 μl–1.3 μl, N=9).</p>
<div id="fig:03" class="fignos">
<figure>
<img src="images/fig03.png" alt="" /><figcaption><span>Figure 3:</span> Distribution of the acinar volumes for each animal.
Left: linear scale, right: logarithmic scale.
The acinar volumes are all significantly different (all p-values better than 4.5e-6, which is the one between days 10 and 21) for each combination of days except between days 4 and 10 (p=0.08).</figcaption>
</figure>
</div>
<p>The acinar volumes show highly significant differences between all possible combinations of days except between days 4 and 10 (p=0.08).
All other p-values are better than p=4.5e-6, which is the p-value for the difference between days 10 and 21.
The statistical analysis is equal to what is briefly described for the entrance ring count above.
The acinar volumes for animals 21E and all animals of day 60 are non-normally distributed, but all acinar volumes per animal are independent (p=5e-29).</p>
<p>To assess the volume distribution per day, we normalized the volumes per day to the largest volume per day (figure <a href="#fig:04">4</a>).
The whiskers in the plots contain all data points 1.5 times the interquartile range past tow low and high quartiles, points outside the whiskers are considered outliers.
The non-outlier data points are closest together on day 4 and slightly more spread out at day 10.
At days 21 and 60, we see no outliers for the normalized acinar volumes.
At days 4, 10 and 21 the distribution of the normalized volumes is skewed towards below the average (median of normalized volumes at day 4: 0.16, at day 10: 0.18 and at day 21: 0.23), we thus see more smaller than larger acini early in the development.
At day 60, the distribution is more homogeneous, with the median of the normalized acinus volumes at exactly 0.50.</p>
<div id="fig:04" class="fignos">
<figure>
<img src="images/fig04.png" alt="" /><figcaption><span>Figure 4:</span> Normalized acinar volumes.
The spread of the volumes is small early in the development and skewed towards the lower end of the volumes.
At day 60, the median is exactly in the middle of the normalized volumes.</figcaption>
</figure>
</div>
<h3 id="alveoli-per-volume">Alveoli per volume</h3>
<p>The mean number of alveoli for the 125 acini at day 4 is 2166 ± 1132 alveoli mm<sup>-3</sup>.
For the 58 acini at day 10 we counted 2831 ± 1189 alveoli mm<sup>-3</sup>, for the 42 acini at day 21 2723 ± 771 alveoli mm<sup>-3</sup> and for the 43 acini at day 60 1080 ± 349 alveoli mm<sup>-3</sup>.
These numbers were found by dividing the counted entrance rings by the acinus volumes.</p>
<p>The numbers for the single animals are shown in table <a href="#tbl:density">3</a> and displayed in figure <a href="#fig:05">5</a>.</p>
<div id="tbl:density" class="tablenos">
<table>
<caption><span>Table 3:</span> Details of alveolar density (number per mm<sup>3</sup>) per acinus volume for each animal. </caption>
<thead>
<tr class="header">
<th>Animal</th>
<th>Assessed acini</th>
<th>Average [mm<sup>-3</sup>]</th>
<th>STD [mm<sup>-3</sup>]</th>
<th>Minimum [mm<sup>-3</sup>]</th>
<th>Maximum [mm<sup>-3</sup>]</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>04A</td>
<td>51</td>
<td>3124</td>
<td>1152</td>
<td>1618</td>
<td>8208</td>
</tr>
<tr class="even">
<td>04B</td>
<td>23</td>
<td>1363</td>
<td>499</td>
<td>679</td>
<td>2704</td>
</tr>
<tr class="odd">
<td>04C</td>
<td>51</td>
<td>1569</td>
<td>380</td>
<td>799</td>
<td>2775</td>
</tr>
<tr class="even">
<td>10A</td>
<td>27</td>
<td>2685</td>
<td>1022</td>
<td>1246</td>
<td>5582</td>
</tr>
<tr class="odd">
<td>10B</td>
<td>14</td>
<td>3091</td>
<td>1166</td>
<td>1890</td>
<td>5422</td>
</tr>
<tr class="even">
<td>10C</td>
<td>17</td>
<td>2848</td>
<td>1462</td>
<td>1182</td>
<td>7009</td>
</tr>
<tr class="odd">
<td>21B</td>
<td>14</td>
<td>2642</td>
<td>493</td>
<td>1625</td>
<td>3344</td>
</tr>
<tr class="even">
<td>21D</td>
<td>17</td>
<td>2534</td>
<td>895</td>
<td>1111</td>
<td>4032</td>
</tr>
<tr class="odd">
<td>21E</td>
<td>11</td>
<td>3119</td>
<td>775</td>
<td>1604</td>
<td>4379</td>
</tr>
<tr class="even">
<td>60B</td>
<td>24</td>
<td>1249</td>
<td>297</td>
<td>530</td>
<td>1912</td>
</tr>
<tr class="odd">
<td>60D</td>
<td>10</td>
<td>838</td>
<td>271</td>
<td>476</td>
<td>1221</td>
</tr>
<tr class="even">
<td>60E</td>
<td>9</td>
<td>898</td>
<td>323</td>
<td>411</td>
<td>1463</td>
</tr>
</tbody>
</table>
</div>
<div id="fig:05" class="fignos">
<figure>
<img src="images/fig05.png" alt="" /><figcaption><span>Figure 5:</span> Number of alveoli per acinus volume.
Left: linear scale, right: logarithmic scale.
The number of alveoli per acinus volume are all significantly different (all p-values are better than 5e-5, which is the one between days 4 and 21) for each combination of days except between days 10 and 21 (p=0.7).</figcaption>
</figure>
</div>
<p>The counts per volume, which correspond to the number of alveoli per acinus volume are one of several measure for influencing the complexity of the single acini.
The number of alveoli per acinus show highly significant differences between all possible combinations of days except between days 10 and 21 (p=0.7).
All other days have a p-value better than p=5e-5, this being the one between days 4 and 21.
The statistical analysis is equal to what is briefly described for the entrance ring count above.
The counts per volume for all animals except 04A are non-normally distributed, but all are independent (p=2.9e-21).</p>
<h3 id="number-of-acini">Number of acini</h3>
<p>The number of acini for day 4 was 18260 ± 16555 acini for day 10 14359 ± 5611 acini, for day 21 11203 ± 2681 acini and for day 60 4277 ± 777 acini.
These numbers were obtained by dividing the parenchymal volume of the lungs <span class="citation" data-cites="wnl86DEM">(<a href="#ref-wnl86DEM" role="doc-biblioref">46</a>)</span> with the Cavalieri-estimated volume of the acini.
To calculate these data we had to use data of two different studies.</p>
<h3 id="total-number-of-alveoli-per-lung">Total number of alveoli per lung</h3>
<p>The total alveolar number for day 4 was found to be 0.64 ± 0.34 million acini, for day 10 1.23 ± 0.39 million acini, for day 21 2.65 ± 0.57 million acini, and for day 60 3.01 ± 0.34 million acini.
The total number of acini was estimated by dividing the mean parenchymal volume of the lungs <span class="citation" data-cites="wnl86DEM">(<a href="#ref-wnl86DEM" role="doc-biblioref">46</a>)</span> by the stereologically estimated acinar volume.
The number of alveoli for each animal is then calculated by multiplying the average entrance ring count per animal with the estimated number of acini per animal.</p>
<h3 id="volume-of-individual-alveoli">Volume of individual alveoli</h3>
<p>The average volume of one alveolus including its part of the alveolar duct was estimated by dividing the mean acinar volume by the mean count of alveoli for each day separately, while correcting for the ductal volume.
For day 4 we estimate the volume of an individual alveolus at 4.98 × 10<sup>5</sup> μm<sup>3</sup>, for day 10 at 3.34 × 10<sup>5</sup> μm<sup>3</sup>, for day 21 at 3.07 × 10<sup>5</sup> μm<sup>3</sup> and for day 60 at 8.12 × 10<sup>5</sup> μm<sup>3</sup>.
This corresponds to an average diameter per alveolus of 98 μm, 86 μm, 84 μm and 116 μm for days 4, 10, 21 and 60, respectively.
The average diameter was estimated by assuming spherical alveoli and solving the volume equation of a sphere to its diameter.</p>
<h2 id="discussion">Discussion</h2>
<p>To our best knowledge, the present manuscript is the first to quantitatively describe the number of alveoli in individual acini and changes in the volumes of single rat lung acini.
Based on stereological analysis of a large number of individual acini we were able to efficiently extract qualitative and quantitative data of large amounts of single acini from non-destructive three-dimensional tomographic data sets in a highly reproducible manner.</p>
<p>We can easily estimate the total number of acini during lung development from our data.
The limitations of this study are mainly twofold: a) due to technical reasons (i.e. available beamtime and limitations of the setup we could not image the entire lung and b) lung location (i.e.  lower medial tip of the right lobe).
However, our sample is more than suitable for the drawn conclusions because it was previously shown that the right lower lobe is a valid sample for the entire lung <span class="citation" data-cites="14OP85b2F">(<a href="#ref-14OP85b2F" role="doc-biblioref">2</a>)</span> and that information drawn from one lobe is representative of the whole lung <span class="citation" data-cites="I9TmP6IU">(<a href="#ref-I9TmP6IU" role="doc-biblioref">52</a>)</span>.
Furthermore, based on stereological data, Zeltner et al. <span class="citation" data-cites="I9TmP6IU">(<a href="#ref-I9TmP6IU" role="doc-biblioref">52</a>)</span> were able to show that the lung parenchyma is quite homogeneous.
Looking at individual acini, Kizhakke Puliyakote et al. <span class="citation" data-cites="RGBeCf8v">(<a href="#ref-RGBeCf8v" role="doc-biblioref">20</a>)</span> observed that the peripheral, pleura facing acini possess an acinar volume which is two thirds larger than the volume of the central ones.
However, they did not report additional regional differences, e.g. between acini located cranially and caudally.
Own preliminary data point to the same result.
We imaged an entire rat lung <em>in situ</em> immediately post mortem using high-resolution synchrotron radiation based X-ray tomographic microscopy <span class="citation" data-cites="Zv1XcgAO">(<a href="#ref-Zv1XcgAO" role="doc-biblioref">4</a>)</span>.
A first analysis of regional difference shows similar results as mentioned above.</p>
<h3 id="acinus-volumes">Acinus volumes</h3>
<p>The mean acinar volume significantly increases during lung development from postnatal days 10 to 60 with all p-values better than 4.5e-6.
No significant difference was observed between postnatal days 4 and 10 (1.2× increase, p=0.08).
A large part of the acinus volume increase happens after day 21 (compare figure <a href="#fig:03">3</a>), which is consistent with previous literature <span class="citation" data-cites="wnl86DEM auNiE56G">(<a href="#ref-auNiE56G" role="doc-biblioref">5</a>, <a href="#ref-wnl86DEM" role="doc-biblioref">46</a>)</span>.</p>
<p>As mentioned in the introduction, Barré et al. <span class="citation" data-cites="14OP85b2F">(<a href="#ref-14OP85b2F" role="doc-biblioref">2</a>)</span> have shown that the number of acini remains constant during lung development, albeit in a different strain of animals (Wistar Bern compared to Sprague-Dawley in this study).
The total volume of the alveolar space increases by roughly a factor of 11 during alveolarization <span class="citation" data-cites="wnl86DEM">(<a href="#ref-wnl86DEM" role="doc-biblioref">46</a>)</span>.
Therefore, we expect the mean volume of the acini to increase by at least the same factor.</p>
<p>We observed a mean increase of the acinus volumes of 22.66 times between days 4 and 60 (p=1.8e-22).
The other combinations of increases were: day 4 to day 21: 3.18× (p=1.3e-9), day 10 to day 21: 2.60× (p=4.5e-6), day 10 to day 60: 18.46× (p=1.4e-17), day 21 to day 60: 7.11×(p=7.1e-15).
The increase from day 4 to day 10 was not significant (p=0.08) at 1.23×).</p>
<p>During the same time, the coefficients of variation of the acinus volumes dropped from 1.26 to 0.49.
At day 4, the mean volumes of the 20 % largest acini are 27.47 times larger than the volumes of the 20 % smallest acini (N=25).
At day 60, the 20 % largest acini are 3.94 times larger than the 20 % smallest acini (N=9).
The size distribution of the largest to smallest acini thus decreases nearly 7 times over the course of the lung development.
This indicates that the dispersion of the value is based on an entirely different pattern of distribution of acinar sizes and that the difference of the mean acinus volumes from the smallest to the largest fraction per day becomes smaller and smaller during postnatal lung development.</p>
<p>When comparing the acinus volumes normalized to the largest volume per day, we found that the volumes are closer together on day 4 and are spread out more on the other days (figure <a href="#fig:04">4</a>).
The normalized volumes (without outliers) are most compact on day 4 and slightly more spread out at day 10.
At days 21 and 60, we see no outliers for the normalized acinar volumes, which thus range from zero to one.
The median of the normalized volumes is smaller than the average at days 4, 10 and 21 while it is exactly at 0.5 for day 60.
This means that we have more smaller than larger acini early in the development and a very homogeneous distribution late in lung development.
This result suggests that acinar growth is not constant during lung development.
It seems that some acini increase their volume faster than others.
As a result, we speculate that an increased percentage of acini is somehow dormant at day 4‐21, while at day 60 most of the acini reached their final volume.</p>
<p>By dividing the parenchymal volumes of each lung estimated by Tschanz et al.
(Table 1, <span class="citation" data-cites="wnl86DEM">(<a href="#ref-wnl86DEM" role="doc-biblioref">46</a>)</span>) by the mean number of acini estimated by Barré et al. <span class="citation" data-cites="uFNlWogb">(<a href="#ref-uFNlWogb" role="doc-biblioref">3</a>)</span> we can estimate the mean acinar volume for each day.
The acinus volume we estimated by point counting (Cavalieri estimation) are on average 2.07 times lower but show a similar increase over the studied period (see figure <a href="#fig:06">6</a>).
It appears that the comparison between data obtained by stereology based on classical paraffin sections or on any kind of 3D-imaging has its limitation if it comes to the absolute numbers.
First, due to the <em>coast of Britain</em>-effect the exact value of every surface measurement is depending on the resolution of the imaging method <span class="citation" data-cites="AdXhaEV4">(<a href="#ref-AdXhaEV4" role="doc-biblioref">24</a>)</span>.
Second, the thickness of the alveolar septa in 3D-imaging data is heavily depending on the segmentation between airspace and tissue—regardless if it is done manually or by a computed algorithm.
We observed that the airspace volumes obtained by 3D-imaging has a tendency to be smaller than the ones determined using classical paraffin sections.
However, the relative numbers obtained in one study match the ones of other studies quite well.</p>
<div id="fig:06" class="fignos">
<figure>
<img src="images/fig06.png" alt="" /><figcaption><span>Figure 6:</span> Plot of the mean acinar volumes.
By dividing the parenchymal volumes of each lung estimated by Tschanz et al.
(Table 1, <span class="citation" data-cites="wnl86DEM">(<a href="#ref-wnl86DEM" role="doc-biblioref">46</a>)</span>) by the mean number of acini estimated by Barre et al. <span class="citation" data-cites="uFNlWogb">(<a href="#ref-uFNlWogb" role="doc-biblioref">3</a>)</span> we can estimate the mean acinar volume for each measured time point (blue plot).
We assessed the volumes of the acini by point counting (Cavalieri estimation, orange plot).
Left: original data.
Right: Our data, scaled by a linear correction factor.
Our volumes of the acini are on average 2.07 times lower but show a similar increase over the studied period.
While the estimation based on Tschanz et al.
is from the entire right middle lobe and on Barre et al.
globally for the whole organ, our estimation is solely based on the stereological analysis of the acini in the lower medial tip of the right lower lung lobe.</figcaption>
</figure>
</div>
<h3 id="number-of-alveoli-per-acinus-volume">Number of alveoli per acinus volume</h3>
<p>The volume and shape of the alveoli, alveolar ducts, and the acini are critical parameters for ventilation and particle deposition <span class="citation" data-cites="eioib1TQ 1HOyVjqpM OT4s1CSX">(<a href="#ref-1HOyVjqpM" role="doc-biblioref">15</a>, <a href="#ref-eioib1TQ" role="doc-biblioref">43</a>, <a href="#ref-OT4s1CSX" role="doc-biblioref">47</a>)</span>.
Particle deposition, for example, is relatively low during the first two weeks of a rats’ life, high at postnatal day P21 and medium at days P36–P90 <span class="citation" data-cites="18DcNLAv6 yHHhvOtP">(<a href="#ref-18DcNLAv6" role="doc-biblioref">22</a>, <a href="#ref-yHHhvOtP" role="doc-biblioref">36</a>)</span>.
This correlates well with our results, where we found a significantly larger number of alveoli per acinus volume at days 10 and 21 compared to days 4 and 60 (p-values all better than 5.4e-5, which is the one for day 4 vs. day 21).
Kreyling et al. <span class="citation" data-cites="18DcNLAv6">(<a href="#ref-18DcNLAv6" role="doc-biblioref">22</a>)</span> report maximal gold nanoparticle retention at this time point (see <a href="https://pubs.acs.org/doi/10.1021/acsnano.8b01826#fig1">their figure 1</a>).</p>
<p>Tschanz et al. <span class="citation" data-cites="wnl86DEM">(<a href="#ref-wnl86DEM" role="doc-biblioref">46</a>)</span> stereologically estimated the mean total acinar volume as the sum of ductal and alveolar air spaces.
The mean volume of the individual alveoli was found to be the smallest around postnatal day 21 (see <a href="https://www.physiology.org/na101/home/literatum/publisher/physio/journals/content/jappl/2014/jappl.2014.117.issue-1/japplphysiol.01355.2013/production/images/medium/zdg0121410620004.jpeg">their figure 4</a>).
If we take the number of alveoli as one possible measure of acinar complexity, we postulate a high acinar complexity at days 10 and 21 while early and late in the lung development, the acinar complexity is relatively low.
This also correlates with structural changes.
In rats, the alveolar air spaces are large during the first two weeks of life, small at day P21 and medium afterward <span class="citation" data-cites="wnl86DEM">(<a href="#ref-wnl86DEM" role="doc-biblioref">46</a>)</span>.</p>
<h3 id="number-of-acini-1">Number of acini</h3>
<p>Previously, it was shown that the number of acini (e.g. counted acinar entraces) remains constant during postnatal lung development from day 4 to 60 <span class="citation" data-cites="14OP85b2F">(<a href="#ref-14OP85b2F" role="doc-biblioref">2</a>)</span>, with a mean of 5840 ± 547 acini per lung (in another strain of animals, full lung data available for days 4 and 60).
Even though we did not aim to assess the number of acini in this manuscript, calculating this number helps to validate our assessment and helps us to collate the data that can be derived from our stereological analysis to prior results.</p>
<p>Based on the acinar and parenchymal volume we calculated the number of acini and were able to verify the previously reported results to lie within our margin of error at days 4 and 60 (Barré et al: 6236 ± 497 acini and 5612 ± 547 acini, respectively).
As shown in figure <a href="#fig:07">7</a>, our values <span class="math inline">\(\pm\)</span> their standard deviation are overlapping the previously found values, even though we generally see a trend that the number of acini seems to decrease during lung development.
This might be due to fusing of several acini to one or simply because we missed some acini in the analysis of the large datasets.</p>
<div id="fig:07" class="fignos">
<figure>
<img src="images/fig07.png" alt="" /><figcaption><span>Figure 7:</span> Plot of the estimated number of acini.
The blue plot shows our estimation, based on the division of the parenchymal volume by the average volume of the acini.
The orange plot is based on the data shown by Barre et al. <span class="citation" data-cites="uFNlWogb 14OP85b2F">(<a href="#ref-14OP85b2F" role="doc-biblioref">2</a>, <a href="#ref-uFNlWogb" role="doc-biblioref">3</a>)</span>.</figcaption>
</figure>
</div>
<h3 id="total-alveolar-number">Total alveolar number</h3>
<p>In this study, we assessed the number of alveoli per acinus. The alveolar By multiplication of the number of acini by the number of alveoli we estimate a total amount of alveoli per lung of  for days 4, 10, 21, &amp; 60, respectively.
Tschanz et al. estimated these total numbers of alveoli per lung as  for days 4, 10, 21, &amp; 60, respectively <span class="citation" data-cites="wnl86DEM">(<a href="#ref-wnl86DEM" role="doc-biblioref">46</a>)</span>, Table 1).
On average, our results are five times smaller but show the same trend when linearly scaled with a factor of 5.04.
The values from Tschanz et al.
overlap well with our linearly scaled values, as shown in figure <a href="#fig:08">8</a>.</p>
<p>As shown in a study by Osmanagic et al. <span class="citation" data-cites="LzalnLBH">(<a href="#ref-LzalnLBH" role="doc-biblioref">29</a>)</span> the total alveolar number shows a large variability between different labs.
E.g. the reported total number of alveoli in adult C57BL6 mice differs by a factor of approximately 8.
All the studies mentioned my Osmanagic et al. were performed in labs well-known for their quality of stereology-based investigations of lung morphology.
Therefore, any simple bias or methodical error may not account for the reported differences.
It seems to be that the total number of alveoli is dependent on unknown small methodical differences and minute differences in how the operator actually does count.</p>
<p>However, relative numbers as reported in this study are more reliable.
This is especially the case when the comparison is done in groups of animals processed in parallel and counted by the same operator.
We assessed the same lungs as Tschanz et al. <span class="citation" data-cites="wnl86DEM">(<a href="#ref-wnl86DEM" role="doc-biblioref">46</a>)</span>, but based on a very different imaging method and with two different persons performing the stereological assessment.
This may explain the relative factor of 5.04 that we found as a difference.</p>
<div id="fig:08" class="fignos">
<figure>
<img src="images/fig08.png" alt="" /><figcaption><span>Figure 8:</span> Number of alveoli based on data from Tschanz et al. <span class="citation" data-cites="wnl86DEM">(<a href="#ref-wnl86DEM" role="doc-biblioref">46</a>)</span> together with our linearly scaled data (our data multiplied by 5.04).
Values are plotted with a band of the width of their standard deviation.</figcaption>
</figure>
</div>
<h3 id="volumes-of-individual-alveoli">Volumes of individual alveoli</h3>
<p>By dividing the alveolar air space by the number of alveoli (both from Table 1 of <span class="citation" data-cites="wnl86DEM">(<a href="#ref-wnl86DEM" role="doc-biblioref">46</a>)</span>) we can estimate a mean alveolar volume of 5.91 × 10<sup>5</sup> μm<sup>3</sup> for day 4, of 2.49 × 10<sup>5</sup> μm<sup>3</sup> for day 10, of 1.34 × 10<sup>5</sup> μm<sup>3</sup> for day 21, and 2.93 × 10<sup>5</sup> μm<sup>3</sup> for day 60.
On average, our values (calculated by dividing the mean acinar volume by the mean count of alveoli per acinus) are 1.81 times larger than these estimates of individual alveolar volume (our values day 4: 4.98 × 10<sup>5</sup> μm<sup>3</sup>, day 10: 3.34 × 10<sup>5</sup> μm<sup>3</sup>, day 21 3.07 × 10<sup>5</sup> μm<sup>3</sup> and day 60 8.12 × 10<sup>5</sup> μm<sup>3</sup>), but scale equally during postnatal lung development.
Tschanz et al.
estimated the total alveolar volume without the alveolar ducts.
Since we directly estimated the volume fraction of the alveoli per acinus our number is actually expected to be larger.</p>
<h3 id="additional-characteristics-of-the-acinus">Additional characteristics of the acinus</h3>
<p>We are well aware that there are many more parameters of the acinar characteristics can be extracted from the acinar datasets we segmented for this study.
Especially of interest are the microarchitecture in the acinus like the branching pattern of the intra-acinar airways or surface area characteristics of the acinar and alveolar walls.
For this study we focused on the easily stereologically available parameters.
Ongoing work in our group is aiming to describe additional parameters of the acinus microarchitecture (e.g. fractal dimension, surface curvature, etc.) but the present study did not aim at characterizing these parameters.</p>
<h3 id="physiological-relevance-of-the-acinar-size">Physiological relevance of the acinar size</h3>
<p>It has been predicted by computational fluid dynamics simulations and by to-scale experiments that the amount and location of massless particle deposition, as well as ventilation, are depending on the size of the acini <span class="citation" data-cites="CVl41LwO 1DP2FRUSZ RJ9GQcwl">(<a href="#ref-CVl41LwO" role="doc-biblioref">8</a>, <a href="#ref-1DP2FRUSZ" role="doc-biblioref">16</a>, <a href="#ref-RJ9GQcwl" role="doc-biblioref">40</a>)</span>.
The predictions could be confirmed at least in one case, where mice received fluorescent particles during mechanical ventilation.
In 3D-visualizations the particles were predominately detected in the proximal half of the acini <span class="citation" data-cites="19jBv0ima">(<a href="#ref-19jBv0ima" role="doc-biblioref">51</a>)</span>.</p>
<p>Based on the above-mentioned knowledge and the data of this study, we propose the following.
In very small acini as the smallest ones, we observed at postnatal day 4 acinar flows are mainly characterized by radial streamlines <span class="citation" data-cites="afF83siN eioib1TQ">(<a href="#ref-afF83siN" role="doc-biblioref">42</a>, <a href="#ref-eioib1TQ" role="doc-biblioref">43</a>)</span>.
Massless particle deposition is governed by diffusion <span class="citation" data-cites="k5fqLjiy">(<a href="#ref-k5fqLjiy" role="doc-biblioref">41</a>)</span>.
As the acini increase in size, convective transport becomes more and more dominant in the proximal regions of the acini.
In larger acini, the proximal region shows much higher particle retention than the distal one, because in this region the larger air-flow induces a circular current, which facilitates alveolar particle deposition.
The proximal regions may even be viewed analogously to a filter capturing the particles whereas the distal regions do not receive significant amounts <span class="citation" data-cites="CVl41LwO 1DP2FRUSZ RJ9GQcwl OT4s1CSX 1HOyVjqpM yHHhvOtP">(<a href="#ref-CVl41LwO" role="doc-biblioref">8</a>, <a href="#ref-1HOyVjqpM" role="doc-biblioref">15</a>, <a href="#ref-1DP2FRUSZ" role="doc-biblioref">16</a>, <a href="#ref-yHHhvOtP" role="doc-biblioref">36</a>, <a href="#ref-RJ9GQcwl" role="doc-biblioref">40</a>, <a href="#ref-OT4s1CSX" role="doc-biblioref">47</a>)</span>.</p>
<p>Multi-breath gas-washout is also dependent on the size of the acini.
Based on computational simulations of nitrogen multi-breath gas-washout it has been shown that small acini washout faster at the beginning and slower at the end of the washout as compared to larger acini <span class="citation" data-cites="eb0gk6VO">(<a href="#ref-eb0gk6VO" role="doc-biblioref">14</a>)</span>.
Not surprisingly, the distribution of the acinar sizes in terms of their range has also an influence on the gas-washout.
Furthermore, a clustering versus an even distribution of the locations of acinar similar sizes effects gas-washout.
Therefore, the question where an acinus of which size is located in the lungs has a significant influence on pulmonary ventilation and particle deposition.</p>
<p>The larger distribution of the acinar sizes at day 4 as compared to day 60 let us speculate what this may mean biologically.
Physiologically, a larger distribution implies less homogeneous ventilation and an increased gas-washout time.
Therefore, the decrease of the inhomogeneity of the acinar sizes may be understood as optimization of the gas-exchange region in the lungs of adult animals.</p>
<p>The consideration of the location is not only a theoretical one, because it has been shown in adult mice that the acini close to the pleura are larger than the central ones <span class="citation" data-cites="RGBeCf8v">(<a href="#ref-RGBeCf8v" role="doc-biblioref">20</a>)</span>.
Therefore, acini of different size are not evenly distributed in the lungs.</p>
<h2 id="conclusion">Conclusion</h2>
<p>Newly formed acini show a large size distribution which is reduced by a factor of 7 until adulthood.
Most likely the latter leads to more homogeneous ventilation of the lung and an increase of gas-washout which is equal to a decreased in the number of breaths needed for gas-washout.</p>
<p>To our best knowledge, no in-depth characterization of the acinar properties as presented here—i.e. spanning the lung development period—was available up to now.
The data presented in this study can contribute to improve computational simulations of pulmonary ventilation and particle deposition.</p>
<h2 id="acknowledgments">Acknowledgments</h2>
<p>We thank Mohammed Ouanella and Bettina de Breuyn for expert technical assistance.
Federica Marone and Bernd Pinzer were of paramount importance with their support at the TOMCAT beamline.
Fluri Wieland was of great help with the statistical analysis.</p>
<p>We are thankful for the support by the Swiss National Science Foundation (grants <a href="http://p3.snf.ch/project-153468">310030_153468</a> and <a href="http://p3.snf.ch/project-175953">310030_175953</a>).</p>
<h2 id="contributions">Contributions</h2>
<p>JS conceived the project.
DH, SB and JS performed the tomographic data acquisition.
DH segmented the acini.
EY and DH stereologically analyzed the acini.
DH, ST, TC and JS analyzed the data.
DH wrote the manuscript and generated all the figures.
ST and JS contributed to writing, all authors proof-read the manuscript.</p>
<h2 id="disclosures">Disclosures</h2>
<p>No conﬂicts of interest, financial or otherwise, are declared by the authors.</p>
<h2 class="page_break_before" id="references">References</h2>
<!-- Explicitly insert bibliography here -->
<div id="refs" class="references" role="doc-bibliography">
<div id="ref-o21zxPIu">
<p>1. <strong>Amrhein V</strong>, <strong>Greenland S</strong>, <strong>McShane B</strong>. Scientists rise up against statistical significance. <em>Nature</em> 567: 305–307, 2019. doi: <a href="https://doi.org/10.1038/d41586-019-00857-9">10.1038/d41586-019-00857-9</a>.</p>
</div>
<div id="ref-14OP85b2F">
<p>2. <strong>Barré SF</strong>, <strong>Haberthür D</strong>, <strong>Cremona TP</strong>, <strong>Stampanoni M</strong>, <strong>Schittny JC</strong>. The total number of acini remains constant throughout postnatal rat lung development. <em>American Journal of Physiology-Lung Cellular and Molecular Physiology</em> 311: L1082–L1089, 2016. doi: <a href="https://doi.org/10.1152/ajplung.00325.2016">10.1152/ajplung.00325.2016</a>.</p>
</div>
<div id="ref-uFNlWogb">
<p>3. <strong>Barré SF</strong>, <strong>Haberthür D</strong>, <strong>Stampanoni M</strong>, <strong>Schittny JC</strong>. Efficient estimation of the total number of acini in adult rat lung. <em>Physiological Reports</em> 2: e12063, 2014. doi: <a href="https://doi.org/10.14814/phy2.12063">10.14814/phy2.12063</a>.</p>
</div>
<div id="ref-Zv1XcgAO">
<p>4. <strong>Borisova E</strong>, <strong>Lovric G</strong>, <strong>Miettinen A</strong>, <strong>Fardin L</strong>, <strong>Bayat S</strong>, <strong>Larsson A</strong>, <strong>Stampanoni M</strong>, <strong>Schittny JC</strong>, <strong>Schlepütz CM</strong>. Micrometer-resolution X-ray tomographic full-volume reconstruction of an intact post-mortem juvenile rat lung..</p>
</div>
<div id="ref-auNiE56G">
<p>5. <strong>Burri PH</strong>, <strong>Dbaly J</strong>, <strong>Weibel ER</strong>. The postnatal growth of the rat lung. I. Morphometry. <em>The Anatomical Record</em> 178: 711–730, 1974. doi: <a href="https://doi.org/10.1002/ar.1091780405">10.1002/ar.1091780405</a>.</p>
</div>
<div id="ref-FE9HLB4f">
<p>6. <strong>CRUZ-ORIVE LM</strong>. Precision of Cavalieri sections and slices with local errors. <em>Journal of Microscopy</em> 193: 182–198, 1999. doi: <a href="https://doi.org/10.1046/j.1365-2818.1999.00460.x">10.1046/j.1365-2818.1999.00460.x</a>.</p>
</div>
<div id="ref-IdRLVLjl">
<p>7. <strong>Erhardt W</strong>, <strong>Kölle P</strong>, <strong>Henke J</strong>, editors. <em>Anästhesie und Analgesie beim Klein- und Heimtier: mit Exoten, Labortieren, Vögeln, Reptilien, Amphibien und Fischen ; mit 137 Tabellen</em>. 2., vollst. überarb. und erw. Aufl. Stuttgart: Schattauer, 2012.</p>
</div>
<div id="ref-CVl41LwO">
<p>8. <strong>Fishler R</strong>, <strong>Hofemeier P</strong>, <strong>Etzion Y</strong>, <strong>Dubowski Y</strong>, <strong>Sznitman J</strong>. Particle dynamics and deposition in true-scale pulmonary acinar models. <em>Scientific Reports</em> 5: 14071, 2015. doi: <a href="https://doi.org/10.1038/srep14071">10.1038/srep14071</a>.</p>
</div>
<div id="ref-V87xbt0b">
<p>9. <strong>Haberthür D</strong>. habi/acinar-analysis: AJP-Submission. Zenodo: 2020.</p>
</div>
<div id="ref-12Z2YPzm8">
<p>10. <strong>Haberthür, David</strong>. DicomReaderAndSaverForSTEPanizer.m [Online]. <em>Gist</em>: [date unknown]. <a href="https://git.io/JTg4F">https://git.io/JTg4F</a> [5 Jan. 2018].</p>
</div>
<div id="ref-7YLeeyu">
<p>11. <strong>Haberthür D</strong>, <strong>Barré SF</strong>, <strong>Tschanz SA</strong>, <strong>Yao E</strong>, <strong>Stampanoni M</strong>, <strong>Schittny JC</strong>. Visualization and stereological characterization of individual rat lung acini by high-resolution X-ray tomographic microscopy. <em>Journal of Applied Physiology</em> 115: 1379–1387, 2013. doi: <a href="https://doi.org/10.1152/japplphysiol.00642.2013">10.1152/japplphysiol.00642.2013</a>.</p>
</div>
<div id="ref-VELl7OiR">
<p>12. <strong>Haberthür D</strong>, <strong>Hintermüller C</strong>, <strong>Marone F</strong>, <strong>Schittny JC</strong>, <strong>Stampanoni M</strong>. Radiation dose optimized lateral expansion of the field of view in synchrotron radiation X-ray tomographic microscopy. <em>Journal of Synchrotron Radiation</em> 17: 590–599, 2010. doi: <a href="https://doi.org/10.1107/s0909049510019618">10.1107/s0909049510019618</a>.</p>
</div>
<div id="ref-BbEFwEVD">
<p>13. <strong>Haefeli-Bleuer B</strong>, <strong>Weibel ER</strong>. Morphometry of the human pulmonary acinus. <em>The Anatomical Record</em> 220: 401–414, 1988. doi: <a href="https://doi.org/10.1002/ar.1092200410">10.1002/ar.1092200410</a>.</p>
</div>
<div id="ref-eb0gk6VO">
<p>14. <strong>Hasler D</strong>, <strong>Anagnostopoulou P</strong>, <strong>Nyilas S</strong>, <strong>Latzin P</strong>, <strong>Schittny J</strong>, <strong>Obrist D</strong>. A multi-scale model of gas transport in the lung to study heterogeneous lung ventilation during the multiple-breath washout test. <em>PLOS Computational Biology</em> 15: e1007079, 2019. doi: <a href="https://doi.org/10.1371/journal.pcbi.1007079">10.1371/journal.pcbi.1007079</a>.</p>
</div>
<div id="ref-1HOyVjqpM">
<p>15. <strong>Henry FS</strong>, <strong>Haber S</strong>, <strong>Haberthür D</strong>, <strong>Filipovic N</strong>, <strong>Milasinovic D</strong>, <strong>Schittny JC</strong>, <strong>Tsuda A</strong>. The Simultaneous Role of an Alveolus as Flow Mixer and Flow Feeder for the Deposition of Inhaled Submicron Particles. <em>Journal of Biomechanical Engineering</em> 134: 121001, 2012. doi: <a href="https://doi.org/10.1115/1.4007949">10.1115/1.4007949</a>.</p>
</div>
<div id="ref-1DP2FRUSZ">
<p>16. <strong>Hofemeier P</strong>, <strong>Sznitman J</strong>. Role of Alveolar Topology on Acinar Flows and Convective Mixing. <em>Journal of Biomechanical Engineering</em> 136: 061007, 2014. doi: <a href="https://doi.org/10.1115/1.4027328">10.1115/1.4027328</a>.</p>
</div>
<div id="ref-dNc8FfNn">
<p>17. <strong>Hsia CCW</strong>, <strong>Hyde DM</strong>, <strong>Ochs M</strong>, <strong>Weibel ER</strong>. An Official Research Policy Statement of the American Thoracic Society/European Respiratory Society: Standards for Quantitative Assessment of Lung Structure. <em>American Journal of Respiratory and Critical Care Medicine</em> 181: 394–418, 2010. doi: <a href="https://doi.org/10.1164/rccm.200809-1522st">10.1164/rccm.200809-1522st</a>.</p>
</div>
<div id="ref-QiAxY2i3">
<p>18. <strong>Hyde DM</strong>, <strong>Tyler NK</strong>, <strong>Putney LF</strong>, <strong>Singh P</strong>, <strong>Gundersen HJG</strong>. Total number and mean size of alveoli in mammalian lung estimated using fractionator sampling and unbiased estimates of the Euler characteristic of alveolar openings. <em>The Anatomical Record</em> 277A: 216–226, 2004. doi: <a href="https://doi.org/10.1002/ar.a.20012">10.1002/ar.a.20012</a>.</p>
</div>
<div id="ref-1AhvLCPky">
<p>19. <strong>Kauffman SL</strong>, <strong>Burri PH</strong>, <strong>Weibel ER</strong>. The postnatal growth of the rat lung II. Autoradiography. <em>The Anatomical Record</em> 180: 63–76, 1974. doi: <a href="https://doi.org/10.1002/ar.1091800108">10.1002/ar.1091800108</a>.</p>
</div>
<div id="ref-RGBeCf8v">
<p>20. <strong>Kizhakke Puliyakote AS</strong>, <strong>Vasilescu DM</strong>, <strong>Newell JD</strong>, <strong>Wang G</strong>, <strong>Weibel ER</strong>, <strong>Hoffman EA</strong>. Morphometric differences between central vs. surface acini in A/J mice using high-resolution micro-computed tomography. <em>Journal of Applied Physiology</em> 121: 115–122, 2016. doi: <a href="https://doi.org/10.1152/japplphysiol.00317.2016">10.1152/japplphysiol.00317.2016</a>.</p>
</div>
<div id="ref-pQ6Wbz73">
<p>21. <strong>Kluyver T</strong>, <strong>Ragan-Kelley B</strong>, <strong>Pérez F</strong>, <strong>Granger B</strong>, <strong>Bussonnier M</strong>, <strong>Frederic J</strong>, <strong>Kelley K</strong>, <strong>Hamrick J</strong>, <strong>Grout J</strong>, <strong>Corlay S</strong>, <strong>Ivanov P</strong>, <strong>Avila D</strong>, <strong>Abdalla S</strong>, <strong>Willing C</strong>, <strong>Jupyter development team</strong>. Jupyter Notebooks – a publishing format for reproducible computational workflows. In: <em>Positioning and Power in Academic Publishing: Players, Agents and Agendas</em>, edited by Loizides F, Scmidt B. 20th International Conference on Electronic Publishing (01/01/16). IOS Press, p. 87–90.</p>
</div>
<div id="ref-18DcNLAv6">
<p>22. <strong>Kreyling WG</strong>, <strong>Möller W</strong>, <strong>Holzwarth U</strong>, <strong>Hirn S</strong>, <strong>Wenk A</strong>, <strong>Schleh C</strong>, <strong>Schäffler M</strong>, <strong>Haberl N</strong>, <strong>Gibson N</strong>, <strong>Schittny JC</strong>. Age-Dependent Rat Lung Deposition Patterns of Inhaled 20 Nanometer Gold Nanoparticles and their Quantitative Biokinetics in Adult Rats. <em>ACS Nano</em> 12: 7771–7790, 2018. doi: <a href="https://doi.org/10.1021/acsnano.8b01826">10.1021/acsnano.8b01826</a>.</p>
</div>
<div id="ref-ON1Bppkk">
<p>23. <strong>Kruskal WH</strong>, <strong>Wallis WA</strong>. Use of Ranks in One-Criterion Variance Analysis. <em>Journal of the American Statistical Association</em> 47: 583–621, 1952. doi: <a href="https://doi.org/10.1080/01621459.1952.10483441">10.1080/01621459.1952.10483441</a>.</p>
</div>
<div id="ref-AdXhaEV4">
<p>24. <strong>Mandelbrot B</strong>. How Long Is the Coast of Britain? Statistical Self-Similarity and Fractional Dimension. <em>Science</em> 156: 636–638, 1967. doi: <a href="https://doi.org/10.1126/science.156.3775.636">10.1126/science.156.3775.636</a>.</p>
</div>
<div id="ref-MyzxBJ57">
<p>25. <strong>Mann HB</strong>, <strong>Whitney DR</strong>. On a Test of Whether one of Two Random Variables is Stochastically Larger than the Other. <em>The Annals of Mathematical Statistics</em> 18: 50–60, 1947. doi: <a href="https://doi.org/10.1214/aoms/1177730491">10.1214/aoms/1177730491</a>.</p>
</div>
<div id="ref-knMAkPPz">
<p>26. <strong>Marone F</strong>, <strong>Hintermüller C</strong>, <strong>McDonald S</strong>, <strong>Abela R</strong>, <strong>Mikuljan G</strong>, <strong>Isenegger A</strong>, <strong>Stampanoni M</strong>. X-ray Tomographic Microscopy at TOMCAT. <em>Journal of Physics: Conference Series</em> 186: 012042, 2009. doi: <a href="https://doi.org/10.1088/1742-6596/186/1/012042">10.1088/1742-6596/186/1/012042</a>.</p>
</div>
<div id="ref-Cp0VRmEj">
<p>27. <strong>Marone F</strong>, <strong>Mokso R</strong>, <strong>Fife JL</strong>, <strong>Irvine S</strong>, <strong>Modregger P</strong>, <strong>Pinzer BR</strong>, <strong>Mader K</strong>, <strong>Isenegger A</strong>, <strong>Mikuljan G</strong>, <strong>Stampanoni M</strong>. Synchrotron-based X-ray Tomographic Microscopy at the Swiss Light Source for Industrial Applications. <em>Synchrotron Radiation News</em> 24: 24–29, 2011. doi: <a href="https://doi.org/10.1080/08940886.2011.634315">10.1080/08940886.2011.634315</a>.</p>
</div>
<div id="ref-c3aIB7f9">
<p>28. <strong>Mercer RR</strong>, <strong>Crapo JD</strong>. Three-dimensional reconstruction of the rat acinus. <em>Journal of Applied Physiology</em> 63: 785–794, 1987. doi: <a href="https://doi.org/10.1152/jappl.1987.63.2.785">10.1152/jappl.1987.63.2.785</a>.</p>
</div>
<div id="ref-LzalnLBH">
<p>29. <strong>Osmanagic E</strong>, <strong>Sukstanskii AL</strong>, <strong>Quirk JD</strong>, <strong>Woods JC</strong>, <strong>Pierce RA</strong>, <strong>Conradi MS</strong>, <strong>Weibel ER</strong>, <strong>Yablonskiy DA</strong>. Quantitative assessment of lung microstructure in healthy mice using an MR-based <sup>3</sup> He lung morphometry technique. <em>Journal of Applied Physiology</em> 109: 1592–1599, 2010. doi: <a href="https://doi.org/10.1152/japplphysiol.00736.2010">10.1152/japplphysiol.00736.2010</a>.</p>
</div>
<div id="ref-1GJECnKBu">
<p>30. <strong>Rodriguez M</strong>, <strong>Bur S</strong>, <strong>Favre A</strong>, <strong>Weibel ER</strong>. Pulmonary acinus: Geometry and morphometry of the peripheral airway system in rat and rabbit. <em>Am J Anat</em> 180: 143–155, 1987. doi: <a href="https://doi.org/10.1002/aja.1001800204">10.1002/aja.1001800204</a>.</p>
</div>
<div id="ref-KGbSQovR">
<p>31. <strong>Scherle W</strong>. A simple method for volumetry of organs in quantitative stereology. [Online]. <em>Mikroskopie</em> 26: 57–60, 1970. <a href="https://www.ncbi.nlm.nih.gov/pubmed/5530651">https://www.ncbi.nlm.nih.gov/pubmed/5530651</a>.</p>
</div>
<div id="ref-XQLPrPTJ">
<p>32. <strong>Schittny JC</strong>. Development of the lung. <em>Cell and Tissue Research</em> 367: 427–444, 2017. doi: <a href="https://doi.org/10.1007/s00441-016-2545-0">10.1007/s00441-016-2545-0</a>.</p>
</div>
<div id="ref-ODQCVC23">
<p>33. <strong>Schittny JC</strong>. How high resolution 3-dimensional imaging changes our understanding of postnatal lung development. <em>Histochemistry and Cell Biology</em> 150: 677–691, 2018. doi: <a href="https://doi.org/10.1007/s00418-018-1749-7">10.1007/s00418-018-1749-7</a>.</p>
</div>
<div id="ref-TsNwin2E">
<p>34. <strong>Schittny JC</strong>, <strong>Burri PH</strong>. Development and growth of the lung [Online]. In: <em>Fishman’s pulmonary diseases and disorders.</em>, edited by Fishman A, Elias J, Fishman J, Grippi M, Senior R, Pack A. McGraw-Hill Professional, p. 91–114. <a href="http://amazon.com/o/ASIN/0071457399/">http://amazon.com/o/ASIN/0071457399/</a>.</p>
</div>
<div id="ref-d1YV8oOK">
<p>35. <strong>Schittny JC</strong>, <strong>Mund SI</strong>, <strong>Stampanoni M</strong>. Evidence and structural mechanism for late lung alveolarization. <em>American Journal of Physiology-Lung Cellular and Molecular Physiology</em> 294: L246–L254, 2008. doi: <a href="https://doi.org/10.1152/ajplung.00296.2007">10.1152/ajplung.00296.2007</a>.</p>
</div>
<div id="ref-yHHhvOtP">
<p>36. <strong>Semmler-Behnke M</strong>, <strong>Kreyling WG</strong>, <strong>Schulz H</strong>, <strong>Takenaka S</strong>, <strong>Butler JP</strong>, <strong>Henry FS</strong>, <strong>Tsuda A</strong>. Nanoparticle delivery in infant lungs. <em>Proceedings of the National Academy of Sciences</em> 109: 5092–5097, 2012. doi: <a href="https://doi.org/10.1073/pnas.1119339109">10.1073/pnas.1119339109</a>.</p>
</div>
<div id="ref-IkHrgIj3">
<p>37. <strong>SHAPIRO SS</strong>, <strong>WILK MB</strong>. An analysis of variance test for normality (complete samples). <em>Biometrika</em> 52: 591–611, 1965. doi: <a href="https://doi.org/10.1093/biomet/52.3-4.591">10.1093/biomet/52.3-4.591</a>.</p>
</div>
<div id="ref-FJ9FoB4m">
<p>38. <strong>Sterio DC</strong>. The unbiased estimation of number and sizes of arbitrary particles using the disector. <em>Journal of Microscopy</em> 134: 127–136, 1984. doi: <a href="https://doi.org/10.1111/j.1365-2818.1984.tb02501.x">10.1111/j.1365-2818.1984.tb02501.x</a>.</p>
</div>
<div id="ref-WDrIHn9p">
<p>39. <strong>Storey WF</strong>, <strong>Staub NC</strong>. Ventilation of terminal air units. <em>Journal of Applied Physiology</em> 17: 391–397, 1962. doi: <a href="https://doi.org/10.1152/jappl.1962.17.3.391">10.1152/jappl.1962.17.3.391</a>.</p>
</div>
<div id="ref-RJ9GQcwl">
<p>40. <strong>Sznitman J</strong>. Convective gas transport in the pulmonary acinus: Comparing roles of convective and diffusive lengths. <em>Journal of Biomechanics</em> 42: 789–792, 2009. doi: <a href="https://doi.org/10.1016/j.jbiomech.2008.12.022">10.1016/j.jbiomech.2008.12.022</a>.</p>
</div>
<div id="ref-k5fqLjiy">
<p>41. <strong>Sznitman J</strong>, <strong>Heimsch F</strong>, <strong>Altorfer D</strong>, <strong>Schittny JC</strong>, <strong>Rösgen T</strong>. Alveolar flow simulations during rhythmical breathing motion in reconstructed XTM acinar airspaces. <em>Journal of Biomechanics</em> 39: S441, 2006. doi: <a href="https://doi.org/10.1016/s0021-9290(06)84801-3">10.1016/s0021-9290(06)84801-3</a>.</p>
</div>
<div id="ref-afF83siN">
<p>42. <strong>Sznitman J</strong>, <strong>Heimsch T</strong>, <strong>Wildhaber JH</strong>, <strong>Tsuda A</strong>, <strong>Rösgen T</strong>. Respiratory Flow Phenomena and Gravitational Deposition in a Three-Dimensional Space-Filling Model of the Pulmonary Acinar Tree. <em>Journal of Biomechanical Engineering</em> 131: 031010, 2009. doi: <a href="https://doi.org/10.1115/1.3049481">10.1115/1.3049481</a>.</p>
</div>
<div id="ref-eioib1TQ">
<p>43. <strong>Sznitman J</strong>, <strong>Sutter R</strong>, <strong>Altorfer D</strong>, <strong>Stampanoni M</strong>, <strong>Rösgen T</strong>, <strong>Schittny JC</strong>. Visualization of respiratory flows from 3D reconstructed alveolar airspaces using X-ray tomographic microscopy. <em>Journal of Visualization</em> 13: 337–345, 2010. doi: <a href="https://doi.org/10.1007/s12650-010-0043-0">10.1007/s12650-010-0043-0</a>.</p>
</div>
<div id="ref-GtCynqsI">
<p>44. <strong>Šidák Z</strong>. Rectangular Confidence Regions for the Means of Multivariate Normal Distributions. <em>Journal of the American Statistical Association</em> 62: 626–633, 1967. doi: <a href="https://doi.org/10.1080/01621459.1967.10482935">10.1080/01621459.1967.10482935</a>.</p>
</div>
<div id="ref-nPoQ2EIB">
<p>45. <strong>TSCHANZ SA</strong>, <strong>BURRI PH</strong>, <strong>WEIBEL ER</strong>. A simple tool for stereological assessment of digital images: the STEPanizer. <em>Journal of Microscopy</em> 243: 47–59, 2011. doi: <a href="https://doi.org/10.1111/j.1365-2818.2010.03481.x">10.1111/j.1365-2818.2010.03481.x</a>.</p>
</div>
<div id="ref-wnl86DEM">
<p>46. <strong>Tschanz SA</strong>, <strong>Salm LA</strong>, <strong>Roth-Kleiner M</strong>, <strong>Barré SF</strong>, <strong>Burri PH</strong>, <strong>Schittny JC</strong>. Rat lungs show a biphasic formation of new alveoli during postnatal development. <em>Journal of Applied Physiology</em> 117: 89–95, 2014. doi: <a href="https://doi.org/10.1152/japplphysiol.01355.2013">10.1152/japplphysiol.01355.2013</a>.</p>
</div>
<div id="ref-OT4s1CSX">
<p>47. <strong>Tsuda A</strong>, <strong>Filipovic N</strong>, <strong>Haberthür D</strong>, <strong>Dickie R</strong>, <strong>Matsui Y</strong>, <strong>Stampanoni M</strong>, <strong>Schittny JC</strong>. Finite element 3D reconstruction of the pulmonary acinus imaged by synchrotron X-ray tomography. <em>Journal of Applied Physiology</em> 105: 964–976, 2008. doi: <a href="https://doi.org/10.1152/japplphysiol.90546.2008">10.1152/japplphysiol.90546.2008</a>.</p>
</div>
<div id="ref-C6OaY84D">
<p>48. <strong>Vasilescu DM</strong>, <strong>Gao Z</strong>, <strong>Saha PK</strong>, <strong>Yin L</strong>, <strong>Wang G</strong>, <strong>Haefeli-Bleuer B</strong>, <strong>Ochs M</strong>, <strong>Weibel ER</strong>, <strong>Hoffman EA</strong>. Assessment of morphometry of pulmonary acini in mouse lungs by nondestructive imaging using multiscale microcomputed tomography. <em>Proceedings of the National Academy of Sciences</em> 109: 17105–17110, 2012. doi: <a href="https://doi.org/10.1073/pnas.1215112109">10.1073/pnas.1215112109</a>.</p>
</div>
<div id="ref-8Miti2Gz">
<p>49. <strong>Virtanen P</strong>, <strong>Gommers R</strong>, <strong>Oliphant TE</strong>, <strong>Haberland M</strong>, <strong>Reddy T</strong>, <strong>Cournapeau D</strong>, <strong>Burovski E</strong>, <strong>Peterson P</strong>, <strong>Weckesser W</strong>, <strong>Bright J</strong>, <strong>van der Walt SJ</strong>, <strong>Brett M</strong>, <strong>Wilson J</strong>, <strong>Millman KJ</strong>, <strong>Mayorov N</strong>, <strong>Nelson ARJ</strong>, <strong>Jones E</strong>, <strong>Kern R</strong>, <strong>Larson E</strong>, <strong>Carey CJ</strong>, <strong>Polat İ</strong>, <strong>Feng Y</strong>, <strong>Moore EW</strong>, <strong>VanderPlas J</strong>, <strong>Laxalde D</strong>, <strong>Perktold J</strong>, <strong>Cimrman R</strong>, <strong>Henriksen I</strong>, <strong>Quintero EA</strong>, <strong>Harris CR</strong>, <strong>Archibald AM</strong>, <strong>Ribeiro AH</strong>, <strong>Pedregosa F</strong>, <strong>van Mulbregt P</strong>, <strong>SciPy 1.0 Contributors</strong>. SciPy 1.0: fundamental algorithms for scientific computing in Python. <em>Nature Methods</em> 17: 261–272, 2020. doi: <a href="https://doi.org/10.1038/s41592-019-0686-2">10.1038/s41592-019-0686-2</a>.</p>
</div>
<div id="ref-CPhMy3Ie">
<p>50. <strong>Woodward JD</strong>, <strong>Maina JN</strong>. A 3D digital reconstruction of the components of the gas exchange tissue of the lung of the muscovy duck, Cairina moschata. <em>Journal of Anatomy</em> 206: 477–492, 2005. doi: <a href="https://doi.org/10.1111/j.1469-7580.2005.00413.x">10.1111/j.1469-7580.2005.00413.x</a>.</p>
</div>
<div id="ref-19jBv0ima">
<p>51. <strong>Yang L</strong>, <strong>Feuchtinger A</strong>, <strong>Möller W</strong>, <strong>Ding Y</strong>, <strong>Kutschke D</strong>, <strong>Möller G</strong>, <strong>Schittny JC</strong>, <strong>Burgstaller G</strong>, <strong>Hofmann W</strong>, <strong>Stoeger T</strong>, <strong>Daniel Razansky</strong>, <strong>Walch A</strong>, <strong>Schmid O</strong>. Three-Dimensional Quantitative Co-Mapping of Pulmonary Morphology and Nanoparticle Distribution with Cellular Resolution in Nondissected Murine Lungs..</p>
</div>
<div id="ref-I9TmP6IU">
<p>52. <strong>Zeltner TB</strong>, <strong>Bertacchini M</strong>, <strong>Messerli A</strong>, <strong>Burri PH</strong>. Morphometric Estimation of Regional Differences in the Rat Lung. <em>Experimental Lung Research</em> 16: 145–158, 2009. doi: <a href="https://doi.org/10.3109/01902149009087879">10.3109/01902149009087879</a>.</p>
</div>
<div id="ref-199ALtdJt">
<p>53. Replacement, Reduction, Refinement [Online]. <em>ALTEX</em> 19: 73–78, 2002. <a href="https://www.altex.org/index.php/altex/article/view/1106">https://www.altex.org/index.php/altex/article/view/1106</a> [8 Dec. 2020].</p>
</div>
</div>
<!-- default theme -->

<style>
    /* import google fonts */
    @import url("https://fonts.googleapis.com/css?family=Open+Sans:400,600,700");
    @import url("https://fonts.googleapis.com/css?family=Source+Code+Pro");

    /* -------------------------------------------------- */
    /* global */
    /* -------------------------------------------------- */

    /* all elements */
    * {
        /* force sans-serif font unless specified otherwise */
        font-family: "Open Sans", "Helvetica", sans-serif;

        /* prevent text inflation on some mobile browsers */
        -webkit-text-size-adjust: none !important;
        -moz-text-size-adjust: none !important;
        -o-text-size-adjust: none !important;
        text-size-adjust: none !important;
    }

    @media only screen {
        /* "page" element */
        body {
            position: relative;
            box-sizing: border-box;
            font-size: 12pt;
            line-height: 1.5;
            max-width: 8.5in;
            margin: 20px auto;
            padding: 40px;
            border-radius: 5px;
            border: solid 1px #bdbdbd;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.05);
            background: #ffffff;
        }
    }

    /* when on screen < 8.5in wide */
    @media only screen and (max-width: 8.5in) {
        /* "page" element */
        body {
            padding: 20px;
            margin: 0;
            border-radius: 0;
            border: none;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.05) inset;
            background: none;
        }
    }

    /* -------------------------------------------------- */
    /* headings */
    /* -------------------------------------------------- */

    /* all headings */
    h1,
    h2,
    h3,
    h4,
    h5,
    h6 {
        margin: 20px 0;
        padding: 0;
        font-weight: bold;
    }

    /* biggest heading */
    h1 {
        margin: 40px 0;
        text-align: center;
    }

    /* second biggest heading */
    h2 {
        margin-top: 30px;
        padding-bottom: 5px;
        border-bottom: solid 1px #bdbdbd;
    }

    /* heading font sizes */
    h1 {
        font-size: 2em;
    }
    h2 {
        font-size: 1.5em;
    }
    h3{
        font-size: 1.35em;
    }
    h4 {
        font-size: 1.25em;
    }
    h5 {
        font-size: 1.15em;
    }
    h6 {
        font-size: 1em;
    }

    /* -------------------------------------------------- */
    /* manuscript header */
    /* -------------------------------------------------- */

    /* manuscript title */
    header > h1 {
        margin: 0;
    }

    /* manuscript title caption text (ie "automatically generated on") */
    header + p {
        text-align: center;
        margin-top: 10px;
    }

    /* -------------------------------------------------- */
    /* text elements */
    /* -------------------------------------------------- */

    /* links */
    a {
        color: #2196f3;
        overflow-wrap: break-word;
    }

    /* normal links (not empty, not button link, not syntax highlighting link) */
    a:not(:empty):not(.button):not(.sourceLine) {
        padding-left: 1px;
        padding-right: 1px;
    }

    /* superscripts and subscripts */
    sub,
    sup {
        /* prevent from affecting line height */
        line-height: 0;
    }

    /* unordered and ordered lists*/
    ul,
    ol {
        padding-left: 20px;
    }

    /* class for styling text semibold */
    .semibold {
        font-weight: 600;
    }

    /* class for styling elements horizontally left aligned */
    .left {
        display: block;
        text-align: left;
        margin-left: auto;
        margin-right: 0;
        justify-content: left;
    }

    /* class for styling elements horizontally centered */
    .center {
        display: block;
        text-align: center;
        margin-left: auto;
        margin-right: auto;
        justify-content: center;
    }

    /* class for styling elements horizontally right aligned */
    .right {
        display: block;
        text-align: right;
        margin-left: 0;
        margin-right: auto;
        justify-content: right;
    }

    /* -------------------------------------------------- */
    /* section elements */
    /* -------------------------------------------------- */

    /* horizontal divider line */
    hr {
        border: none;
        height: 1px;
        background: #bdbdbd;
    }

    /* paragraphs, horizontal dividers, figures, tables, code */
    p,
    hr,
    figure,
    table,
    pre {
        /* treat all as "paragraphs", with consistent vertical margins */
        margin-top: 20px;
        margin-bottom: 20px;
    }

    /* -------------------------------------------------- */
    /* figures */
    /* -------------------------------------------------- */

    /* figure */
    figure {
        max-width: 100%;
        margin-left: auto;
        margin-right: auto;
    }

    /* figure caption */
    figcaption {
        padding: 0;
        padding-top: 10px;
    }

    /* figure image element */
    figure > img,
    figure > svg {
        max-width: 100%;
        display: block;
        margin-left: auto;
        margin-right: auto;
    }

    /* figure auto-number */
    img + figcaption > span:first-of-type,
    svg + figcaption > span:first-of-type {
        font-weight: bold;
        margin-right: 5px;
    }

    /* -------------------------------------------------- */
    /* tables */
    /* -------------------------------------------------- */

    /* table */
    table {
        border-collapse: collapse;
        border-spacing: 0;
        width: 100%;
        margin-left: auto;
        margin-right: auto;
    }

    /* table cells */
    th,
    td {
        border: solid 1px #bdbdbd;
        padding: 10px;
        /* squash table if too wide for page by forcing line breaks */
        overflow-wrap: break-word;
        word-break: break-word;
    }

    /* header row and even rows */
    th,
    tr:nth-child(2n) {
        background-color: #fafafa;
    }

    /* odd rows */
    tr:nth-child(2n + 1) {
        background-color: #ffffff;
    }

    /* table caption */
    caption {
        text-align: left;
        padding: 0;
        padding-bottom: 10px;
    }

    /* table auto-number */
    table > caption > span:first-of-type,
    div.table_wrapper > table > caption > span:first-of-type {
        font-weight: bold;
        margin-right: 5px;
    }

    /* -------------------------------------------------- */
    /* code */
    /* -------------------------------------------------- */

    /* multi-line code block */
    pre {
        padding: 10px;
        background-color: #eeeeee;
        color: #000000;
        border-radius: 5px;
        break-inside: avoid;
        text-align: left;
    }

    /* inline code, ie code within normal text */
    :not(pre) > code {
        padding: 0 4px;
        background-color: #eeeeee;
        color: #000000;
        border-radius: 5px;
    }

    /* code text */
    /* apply all children, to reach syntax highlighting sub-elements */
    code,
    code * {
        /* force monospace font */
        font-family: "Source Code Pro", "Courier New", monospace;
    }

    /* -------------------------------------------------- */
    /* quotes */
    /* -------------------------------------------------- */

    /* quoted text */
    blockquote {
        margin: 0;
        padding: 0;
        border-left: 4px solid #bdbdbd;
        padding-left: 16px;
        break-inside: avoid;
    }

    /* -------------------------------------------------- */
    /* banners */
    /* -------------------------------------------------- */

    /* info banners */
    .banner {
        box-sizing: border-box;
        display: block;
        position: relative;
        width: 100%;
        margin-top: 20px;
        margin-bottom: 20px;
        padding: 20px;
        text-align: center;
    }

    /* paragraph in banner */
    .banner > p {
        margin: 0;
    }

    /* -------------------------------------------------- */
    /* highlight colors */
    /* -------------------------------------------------- */

    .white {
        background: #ffffff;
    }
    .lightgrey {
        background: #eeeeee;
    }
    .grey {
        background: #757575;
    }
    .darkgrey {
        background: #424242;
    }
    .black {
        background: #000000;
    }
    .lightred {
        background: #ffcdd2;
    }
    .lightyellow {
        background: #ffecb3;
    }
    .lightgreen {
        background: #dcedc8;
    }
    .lightblue {
        background: #e3f2fd;
    }
    .lightpurple {
        background: #f3e5f5;
    }
    .red {
        background: #f44336;
    }
    .orange {
        background: #ff9800;
    }
    .yellow {
        background: #ffeb3b;
    }
    .green {
        background: #4caf50;
    }
    .blue {
        background: #2196f3;
    }
    .purple {
        background: #9c27b0;
    }
    .white,
    .lightgrey,
    .lightred,
    .lightyellow,
    .lightgreen,
    .lightblue,
    .lightpurple,
    .orange,
    .yellow,
    .white a,
    .lightgrey a,
    .lightred a,
    .lightyellow a,
    .lightgreen a,
    .lightblue a,
    .lightpurple a,
    .orange a,
    .yellow a {
        color: #000000;
    }
    .grey,
    .darkgrey,
    .black,
    .red,
    .green,
    .blue,
    .purple,
    .grey a,
    .darkgrey a,
    .black a,
    .red a,
    .green a,
    .blue a,
    .purple a {
        color: #ffffff;
    }

    /* -------------------------------------------------- */
    /* buttons */
    /* -------------------------------------------------- */

    /* class for styling links like buttons */
    .button {
        display: inline-flex;
        justify-content: center;
        align-items: center;
        margin: 5px;
        padding: 10px 20px;
        font-size: 0.75em;
        font-weight: 600;
        text-transform: uppercase;
        text-decoration: none;
        letter-spacing: 1px;
        background: none;
        color: #2196f3;
        border: solid 1px #bdbdbd;
        border-radius: 5px;
    }

    /* buttons when hovered */
    .button:hover:not([disabled]),
    .icon_button:hover:not([disabled]) {
        cursor: pointer;
        background: #f5f5f5;
    }

    /* buttons when disabled */
    .button[disabled],
    .icon_button[disabled] {
        opacity: 0.35;
        pointer-events: none;
    }

    /* class for styling buttons containg only single icon */
    .icon_button {
        display: inline-flex;
        justify-content: center;
        align-items: center;
        text-decoration: none;
        margin: 0;
        padding: 0;
        background: none;
        border-radius: 5px;
        border: none;
        width: 20px;
        height: 20px;
        min-width: 20px;
        min-height: 20px;
    }

    /* icon button inner svg image */
    .icon_button > svg {
        height: 16px;
    }

    /* -------------------------------------------------- */
    /* icons */
    /* -------------------------------------------------- */

    /* class for styling icons inline with text */
    .inline_icon {
        height: 1em;
        position: relative;
        top: 0.125em;
    }

    /* -------------------------------------------------- */
    /* print control */
    /* -------------------------------------------------- */

    @media print {
        @page {
            /* suggested printing margin */
            margin: 0.5in;
        }

        /* document and "page" elements */
        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
        }

        /* "page" element */
        body {
            font-size: 11pt !important;
            line-height: 1.35;
        }

        /* all headings */
        h1,
        h2,
        h3,
        h4,
        h5,
        h6 {
            margin: 15px 0;
        }

        /* figures and tables */
        figure, table {
            font-size: 0.85em;
        }

        /* table cells */
        th,
        td {
            padding: 5px;
        }

        /* shrink font awesome icons */
        i.fas,
        i.fab,
        i.far,
        i.fal {
            transform: scale(0.85);
        }

        /* decrease banner margins */
        .banner {
            margin-top: 15px;
            margin-bottom: 15px;
            padding: 15px;
        }

        /* class for centering an element vertically on its own page */
        .page_center {
            margin: auto;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            vertical-align: middle;
            break-before: page;
            break-after: page;
        }

        /* always insert a page break before the element */
        .page_break_before {
            break-before: page;
        }

        /* always insert a page break after the element */
        .page_break_after {
            break-after: page;
        }

        /* avoid page break before the element */
        .page_break_before_avoid {
            break-before: avoid;
        }

        /* avoid page break after the element */
        .page_break_after_avoid {
            break-after: avoid;
        }

        /* avoid page break inside the element */
        .page_break_inside_avoid {
            break-inside: avoid;
        }
    }

    /* -------------------------------------------------- */
    /* override pandoc css quirks */
    /* -------------------------------------------------- */

    .sourceCode {
        /* prevent unsightly overflow in wide code blocks */
        overflow: auto !important;
    }

    div.sourceCode {
        /* prevent background fill on top-most code block  container */
        background: none !important;
    }

    .sourceCode * {
        /* force consistent line spacing */
        line-height: 1.5 !important;
    }

    div.sourceCode {
        /* style code block margins same as <pre> element */
        margin-top: 20px;
        margin-bottom: 20px;
    }

    /* -------------------------------------------------- */
    /* tablenos */
    /* -------------------------------------------------- */

    /* tablenos wrapper */
    .tablenos {
        /* show scrollbar on tables if necessary to prevent overflow */
        width: 100%;
        margin: 20px 0;
    }

    .tablenos > table {
        /* move margins from table to table_wrapper to allow margin collapsing */
        margin: 0;
    }

    @media only screen {
        /* tablenos wrapper */
        .tablenos {
            /* show scrollbar on tables if necessary to prevent overflow */
            overflow-x: auto !important;
        }

        .tablenos th,
        .tablenos td {
            overflow-wrap: unset !important;
            word-break: unset !important;
        }

        /* table in wrapper */
        .tablenos table,
        .tablenos table * {
            /* don't break table words */
            overflow-wrap: normal !important;
        }
    }

    /* -------------------------------------------------- */
    /* mathjax */
    /* -------------------------------------------------- */

    /* mathjax containers */
    .math.display > span:not(.MathJax_Preview) {
        /* turn inline element (no dimensions) into block (allows fixed width and thus scrolling) */
        display: flex !important;
        overflow-x: auto !important;
        overflow-y: hidden !important;
        justify-content: center;
        align-items: center;
        margin: 0 !important;
    }

    /* right click menu */
    .MathJax_Menu {
        border-radius: 5px !important;
        border: solid 1px #bdbdbd !important;
        box-shadow: none !important;
    }

    /* equation auto-number */
    span[id^="eq:"] > span.math.display + span {
        font-weight: 600;
    }

    /* equation */
    span[id^="eq:"] > span.math.display > span {
        /* nudge to make room for equation auto-number and anchor */
        margin-right: 60px !important;
    }

    /* -------------------------------------------------- */
    /* anchors plugin */
    /* -------------------------------------------------- */

    @media only screen {
        /* anchor button */
        .anchor {
            opacity: 0;
            margin-left: 5px;
        }

        /* anchor buttons within <h2>'s */
        h2 .anchor {
            margin-left: 10px;
        }

        /* anchor buttons when hovered/focused and anything containing an anchor button when hovered */
        *:hover > .anchor,
        .anchor:hover,
        .anchor:focus {
            opacity: 1;
        }

        /* anchor button when hovered */
        .anchor:hover {
            cursor: pointer;
        }
    }

    /* always show anchor button on devices with no mouse/hover ability */
    @media (hover: none) {
        .anchor {
            opacity: 1;
        }
    }

    /* always hide anchor button on print */
    @media only print {
        .anchor {
            display: none;
        }
    }

    /* -------------------------------------------------- */
    /* accordion plugin */
    /* -------------------------------------------------- */

    @media only screen {
        /* accordion arrow button */
        .accordion_arrow {
            margin-right: 10px;
        }

        /* arrow icon when <h2> data-collapsed attribute true */
        h2[data-collapsed="true"] > .accordion_arrow > svg {
            transform: rotate(-90deg);
        }

        /* all elements (except <h2>'s) when data-collapsed attribute true */
        *:not(h2)[data-collapsed="true"] {
            display: none;
        }

        /* accordion arrow button when hovered and <h2>'s when hovered */
        .accordion_arrow:hover,
        h2[data-collapsed="true"]:hover,
        h2[data-collapsed="false"]:hover {
            cursor: pointer;
        }
    }

    /* always hide accordion arrow button on print */
    @media only print {
        .accordion_arrow {
            display: none;
        }
    }

    /* -------------------------------------------------- */
    /* tooltips plugin */
    /* -------------------------------------------------- */

    @media only screen {
        /* tooltip container */
        #tooltip {
            position: absolute;
            width: 50%;
            min-width: 240px;
            max-width: 75%;
            z-index: 1;
        }

        /* tooltip content */
        #tooltip_content {
            margin-bottom: 5px;
            padding: 20px;
            border-radius: 5px;
            border: solid 1px #bdbdbd;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.05);
            background: #ffffff;
            overflow-wrap: break-word;
        }

        /* tooltip copy of paragraphs and figures */
        #tooltip_content > p,
        #tooltip_content > figure {
            margin: 0;
            max-height: 320px;
            overflow-y: auto;
        }

        /* tooltip copy of <img> */
        #tooltip_content > figure > img,
        #tooltip_content > figure > svg {
            max-height: 260px;
        }

        /* navigation bar */
        #tooltip_nav_bar {
            margin-top: 10px;
            text-align: center;
        }

        /* navigation bar previous/next buton */
        #tooltip_nav_bar > .icon_button {
            position: relative;
            top: 3px;
        }

        /* navigation bar previous button */
        #tooltip_nav_bar > .icon_button:first-of-type {
            margin-right: 5px;
        }

        /* navigation bar next button */
        #tooltip_nav_bar > .icon_button:last-of-type {
            margin-left: 5px;
        }
    }

    /* always hide tooltip on print */
    @media only print {
        #tooltip {
            display: none;
        }
    }

    /* -------------------------------------------------- */
    /* jump to first plugin */
    /* -------------------------------------------------- */

    @media only screen {
        /* jump button */
        .jump_arrow {
            position: relative;
            top: 0.125em;
            margin-right: 5px;
        }
    }

    /* always hide jump button on print */
    @media only print {
        .jump_arrow {
            display: none;
        }
    }

    /* -------------------------------------------------- */
    /* link highlight plugin */
    /* -------------------------------------------------- */

    @media only screen {
        /* anything with data-highlighted attribute true */
        [data-highlighted="true"] {
            background: #ffeb3b;
        }

        /* anything with data-selected attribute true */
        [data-selected="true"] {
            background: #ff8a65 !important;
        }

        /* animation definition for glow */
        @keyframes highlight_glow {
            0% {
                background: none;
            }
            10% {
                background: #bbdefb;
            }
            100% {
                background: none;
            }
        }

        /* anything with data-glow attribute true */
        [data-glow="true"] {
            animation: highlight_glow 2s;
        }
    }

    /* -------------------------------------------------- */
    /* table of contents plugin */
    /* -------------------------------------------------- */

    @media only screen {
        /* toc panel */
        #toc_panel {
            box-sizing: border-box;
            position: fixed;
            top: 0;
            left: 0;
            background: #ffffff;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.05);
            z-index: 2;
        }

        /* toc panel when closed */
        #toc_panel[data-open="false"] {
            min-width: 60px;
            width: 60px;
            height: 60px;
            border-right: solid 1px #bdbdbd;
            border-bottom: solid 1px #bdbdbd;
        }

        /* toc panel when open */
        #toc_panel[data-open="true"] {
            min-width: 260px;
            max-width: 480px;
            /* keep panel edge consistent distance away from "page" edge */
            width: calc(((100vw - 8.5in) / 2) - 30px - 40px);
            bottom: 0;
            border-right: solid 1px #bdbdbd;
        }

        /* toc panel header */
        #toc_header {
            box-sizing: border-box;
            display: flex;
            flex-direction: row;
            align-items: center;
            height: 60px;
            margin: 0;
            padding: 20px;
        }

        /* toc panel header when hovered */
        #toc_header:hover {
            cursor: pointer;
        }

        /* toc panel header when panel open */
        #toc_panel[data-open="true"] > #toc_header {
            border-bottom: solid 1px #bdbdbd;
        }

        /* toc open/close header button */
        #toc_button {
            margin-right: 20px;
        }

        /* hide toc list and header text when closed */
        #toc_panel[data-open="false"] > #toc_header > *:not(#toc_button),
        #toc_panel[data-open="false"] > #toc_list {
            display: none;
        }

        /* toc list of entries */
        #toc_list {
            box-sizing: border-box;
            width: 100%;
            padding: 20px;
            position: absolute;
            top: calc(60px + 1px);
            bottom: 0;
            overflow: auto;
        }

        /* toc entry, link to section in document */
        .toc_link {
            display: block;
            padding: 5px;
            position: relative;
            font-weight: 600;
            text-decoration: none;
        }

        /* toc entry when hovered or when "viewed" */
        .toc_link:hover,
        .toc_link[data-viewing="true"] {
            background: #f5f5f5;
        }

        /* toc entry, level 1 indentation */
        .toc_link[data-level="1"] {
            margin-left: 0;
        }

        /* toc entry, level 2 indentation */
        .toc_link[data-level="2"] {
            margin-left: 20px;
        }

        /* toc entry, level 3 indentation */
        .toc_link[data-level="3"] {
            margin-left: 40px;
        }

        /* toc entry, level 4 indentation */
        .toc_link[data-level="4"] {
            margin-left: 60px;
        }

        /* toc entry bullets */
        #toc_panel[data-bullets="true"] .toc_link[data-level]:before {
            position: absolute;
            left: -15px;
            top: -1px;
            font-size: 1.5em;
        }

        /* toc entry, level 2 bullet */
        #toc_panel[data-bullets="true"] .toc_link[data-level="2"]:before {
            content: "\2022";
        }

        /* toc entry, level 3 bullet */
        #toc_panel[data-bullets="true"] .toc_link[data-level="3"]:before {
            content: "\25AB";
        }

        /* toc entry, level 4 bullet */
        #toc_panel[data-bullets="true"] .toc_link[data-level="4"]:before {
            content: "-";
        }
    }

    /* when on screen < 8.5in wide */
    @media only screen and (max-width: 8.5in) {
        /* push <body> ("page") element down to make room for toc icon */
        .toc_body_nudge {
            padding-top: 60px;
        }

        /* toc icon when panel closed and not hovered */
        #toc_panel[data-open="false"]:not(:hover) {
            background: rgba(255, 255, 255, 0.75);
        }
    }

    /* always hide toc panel on print */
    @media only print {
        #toc_panel {
            display: none;
        }
    }

    /* -------------------------------------------------- */
    /* lightbox plugin */
    /* -------------------------------------------------- */

    @media only screen {
        /* regular <img> in document when hovered */
        img.lightbox_document_img:hover {
            cursor: pointer;
        }

        .body_no_scroll {
            overflow: hidden !important;
        }

        /* screen overlay */
        #lightbox_overlay {
            display: flex;
            flex-direction: column;
            position: fixed;
            left: 0;
            top: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.75);
            z-index: 3;
        }

        /* middle area containing lightbox image */
        #lightbox_image_container {
            flex-grow: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            position: relative;
            padding: 20px;
        }

        /* bottom area containing caption */
        #lightbox_bottom_container {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100px;
            min-height: 100px;
            max-height: 100px;
            background: rgba(0, 0, 0, 0.5);
        }

        /* image number info text box */
        #lightbox_number_info {
            position: absolute;
            color: #ffffff;
            font-weight: 600;
            left: 2px;
            top: 0;
            z-index: 4;
        }

        /* zoom info text box */
        #lightbox_zoom_info {
            position: absolute;
            color: #ffffff;
            font-weight: 600;
            right: 2px;
            top: 0;
            z-index: 4;
        }

        /* copy of image caption */
        #lightbox_caption {
            box-sizing: border-box;
            display: inline-block;
            width: 100%;
            max-height: 100%;
            padding: 10px 0;
            text-align: center;
            overflow-y: auto;
            color: #ffffff;
        }

        /* navigation previous/next button */
        .lightbox_button {
            width: 100px;
            height: 100%;
            min-width: 100px;
            min-height: 100%;
            color: #ffffff;
        }

        /* navigation previous/next button when hovered */
        .lightbox_button:hover {
            background: none !important;
        }

        /* navigation button icon */
        .lightbox_button > svg {
            height: 25px;
        }

        /* figure auto-number */
        #lightbox_caption > span:first-of-type {
            font-weight: bold;
            margin-right: 5px;
        }

        /* lightbox image when hovered */
        #lightbox_img:hover {
            cursor: grab;
        }

        /* lightbox image when grabbed */
        #lightbox_img:active {
            cursor: grabbing;
        }
    }

    /* when on screen < 480px wide */
    @media only screen and (max-width: 480px) {
        /* make navigation buttons skinnier on small screens to make more room for caption text */
        .lightbox_button {
            width: 50px;
            min-width: 50px;
        }
    }

    /* always hide lightbox on print */
    @media only print {
        #lightbox_overlay {
            display: none;
        }
    }

    /* -------------------------------------------------- */
    /* hypothesis (annotations) plugin */
    /* -------------------------------------------------- */

    /* hypothesis activation button */
    #hypothesis_button {
        box-sizing: border-box;
        position: fixed;
        top: 0;
        right: 0;
        width: 60px;
        height: 60px;
        background: #ffffff;
        border-radius: 0;
        border-left: solid 1px #bdbdbd;
        border-bottom: solid 1px #bdbdbd;
        box-shadow: 0 0 20px rgba(0, 0, 0, 0.05);
        z-index: 2;
    }

    /* hypothesis button svg */
    #hypothesis_button > svg {
        position: relative;
        top: -4px;
    }

    /* hypothesis annotation count */
    #hypothesis_count {
        position: absolute;
        left: 0;
        right: 0;
        bottom: 5px;
    }

    /* side panel */
    .annotator-frame {
        width: 280px !important;
    }

    /* match highlight color to rest of theme */
    .annotator-highlights-always-on .annotator-hl {
        background-color: #ffeb3b !important;
    }

    /* match focused color to rest of theme */
    .annotator-hl.annotator-hl-focused {
        background-color: #ff8a65 !important;
    }

    /* match bucket bar color to rest of theme */
    .annotator-bucket-bar {
        background: #f5f5f5 !important;
    }

    /* always hide button, toolbar, and tooltip on print */
    @media only print {
        #hypothesis_button {
            display: none;
        }

        .annotator-frame {
            display: none !important;
        }

        hypothesis-adder {
            display: none !important;
        }
    }
</style>
<!-- anchors plugin -->

<script>
    (function() {
        // /////////////////////////
        // DESCRIPTION
        // /////////////////////////

        // This Manubot plugin adds an anchor next to each of a certain type
        // of element that provides a human-readable url to that specific
        // item/position in the document (eg "manuscript.html#abstract"). It
        // also makes it such that scrolling out of view of a target removes
        // its identifier from the url.

        // /////////////////////////
        // OPTIONS
        // /////////////////////////

        // plugin name prefix for url parameters
        const pluginName = 'anchors';

        // default plugin options
        const options = {
            // which types of elements to add anchors next to, in
            // "document.querySelector" format
            typesQuery: 'h1, h2, h3, [id^="fig:"], [id^="tbl:"], [id^="eq:"]',
            // whether plugin is on or not
            enabled: 'true'
        };

        // change options above, or override with url parameter, eg:
        // 'manuscript.html?pluginName-enabled=false'

        // /////////////////////////
        // SCRIPT
        // /////////////////////////

        // start script
        function start() {
            // add anchor to each element of specified types
            const elements = document.querySelectorAll(options.typesQuery);
            for (const element of elements)
                addAnchor(element);

            // attach scroll listener to window
            window.addEventListener('scroll', onScroll);
        }

        // when window is scrolled
        function onScroll() {
            // if url has hash and user has scrolled out of view of hash
            // target, remove hash from url
            const tolerance = 100;
            const target = getHashTarget();
            if (target) {
                if (
                    target.getBoundingClientRect().top >
                        window.innerHeight + tolerance ||
                    target.getBoundingClientRect().bottom < 0 - tolerance
                )
                    history.pushState(null, null, ' ');
            }
        }

        // add anchor to element
        function addAnchor(element) {
            let addTo; // element to add anchor button to

            // if figure or table, modify withId and addTo to get expected
            // elements
            if (element.id.indexOf('fig:') === 0) {
                addTo = element.querySelector('figcaption');
            } else if (element.id.indexOf('tbl:') === 0) {
                addTo = element.querySelector('caption');
            } else if (element.id.indexOf('eq:') === 0) {
                addTo = element.querySelector('.eqnos-number');
            }

            addTo = addTo || element;
            const id = element.id || null;

            // do not add anchor if element doesn't have assigned id.
            // id is generated by pandoc and is assumed to be unique and
            // human-readable
            if (!id)
                return;

            // create anchor button
            const anchor = document.createElement('a');
            anchor.innerHTML = document.querySelector('.icon_link').innerHTML;
            anchor.title = 'Link to this part of the document';
            anchor.classList.add('icon_button', 'anchor');
            anchor.dataset.ignore = 'true';
            anchor.href = '#' + id;
            addTo.appendChild(anchor);
        }

        // get element that is target of link or url hash
        function getHashTarget() {
            const hash = window.location.hash;
            const id = hash.slice(1);
            let target = document.querySelector('[id="' + id + '"]');
            if (!target)
                return;

            // if figure or table, modify target to get expected element
            if (id.indexOf('fig:') === 0)
                target = target.querySelector('figure');
            if (id.indexOf('tbl:') === 0)
                target = target.querySelector('table');

            return target;
        }

        // load options from url parameters
        function loadOptions() {
            const url = window.location.search;
            const params = new URLSearchParams(url);
            for (const optionName of Object.keys(options)) {
                const paramName = pluginName + '-' + optionName;
                const param = params.get(paramName);
                if (param !== '' && param !== null)
                    options[optionName] = param;
            }
        }
        loadOptions();

        // start script when document is finished loading
        if (options.enabled === 'true')
            window.addEventListener('load', start);
    })();
</script>

<!-- link icon -->

<template class="icon_link">
    <!-- modified from: https://fontawesome.com/icons/link -->
    <svg width="16" height="16" viewBox="0 0 512 512">
        <path
            fill="currentColor"
            d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"
        ></path>
    </svg>
</template>
<!-- accordion plugin -->

<script>
    (function() {
        // /////////////////////////
        // DESCRIPTION
        // /////////////////////////

        // This Manubot plugin allows sections of content under <h2> headings
        // to be collapsible.

        // /////////////////////////
        // OPTIONS
        // /////////////////////////

        // plugin name prefix for url parameters
        const pluginName = 'accordion';

        // default plugin options
        const options = {
            // whether to always start expanded ('false'), always start
            // collapsed ('true'), or start collapsed when screen small ('auto')
            startCollapsed: 'auto',
            // whether plugin is on or not
            enabled: 'true'
        };

        // change options above, or override with url parameter, eg:
        // 'manuscript.html?pluginName-enabled=false'

        // /////////////////////////
        // SCRIPT
        // /////////////////////////

        // start script
        function start() {
            // run through each <h2> heading
            const headings = document.querySelectorAll('h2');
            for (const heading of headings) {
                addArrow(heading);

                // start expanded/collapsed based on option
                if (
                    options.startCollapsed === 'true' ||
                    (options.startCollapsed === 'auto' && isSmallScreen())
                )
                    collapseHeading(heading);
                else
                    expandHeading(heading);
            }

            // attach hash change listener to window
            window.addEventListener('hashchange', onHashChange);
        }

        // when hash (eg manuscript.html#introduction) changes
        function onHashChange() {
            const target = getHashTarget();
            if (target)
                goToElement(target);
        }

        // add arrow to heading
        function addArrow(heading) {
            // add arrow button
            const arrow = document.createElement('button');
            arrow.innerHTML = document.querySelector(
                '.icon_angle_down'
            ).innerHTML;
            arrow.classList.add('icon_button', 'accordion_arrow');
            heading.insertBefore(arrow, heading.firstChild);

            // attach click listener to heading and button
            heading.addEventListener('click', onHeadingClick);
            arrow.addEventListener('click', onArrowClick);
        }

        // determine if on mobile-like device with small screen
        function isSmallScreen() {
            return Math.min(window.innerWidth, window.innerHeight) < 480;
        }

        // scroll to and focus element
        function goToElement(element, offset) {
            // expand accordion section if collapsed
            expandElement(element);
            const y =
                getRectInView(element).top -
                getRectInView(document.documentElement).top -
                (offset || 0);
            // trigger any function listening for "onscroll" event
            window.dispatchEvent(new Event('scroll'));
            window.scrollTo(0, y);
            document.activeElement.blur();
            element.focus();
        }

        // get element that is target of hash
        function getHashTarget(link) {
            const hash = link ? link.hash : window.location.hash;
            const id = hash.slice(1);
            let target = document.querySelector('[id="' + id + '"]');
            if (!target)
                return;

            // if figure or table, modify target to get expected element
            if (id.indexOf('fig:') === 0)
                target = target.querySelector('figure');
            if (id.indexOf('tbl:') === 0)
                target = target.querySelector('table');

            return target;
        }

        // when <h2> heading is clicked
        function onHeadingClick(event) {
            // only collapse if <h2> itself is target of click (eg, user did
            // not click on anchor within <h2>)
            if (event.target === this)
                toggleCollapse(this);
        }

        // when arrow button is clicked
        function onArrowClick() {
            toggleCollapse(this.parentNode);
        }

        // collapse section if expanded, expand if collapsed
        function toggleCollapse(heading) {
            if (heading.dataset.collapsed === 'false')
                collapseHeading(heading);
            else
                expandHeading(heading);
        }

        // elements to exclude from collapse, such as table of contents panel,
        // hypothesis panel, etc
        const exclude = '#toc_panel, div.annotator-frame, #lightbox_overlay';

        // collapse section
        function collapseHeading(heading) {
            heading.setAttribute('data-collapsed', 'true');
            const children = getChildren(heading);
            for (const child of children)
                child.setAttribute('data-collapsed', 'true');
        }

        // expand section
        function expandHeading(heading) {
            heading.setAttribute('data-collapsed', 'false');
            const children = getChildren(heading);
            for (const child of children)
                child.setAttribute('data-collapsed', 'false');
        }

        // get list of elements between this <h2> and next <h2> or <h1>
        // ("children" of the <h2> section)
        function getChildren(heading) {
            return nextUntil(heading, 'h2, h1', exclude);
        }

        // get position/dimensions of element or viewport
        function getRectInView(element) {
            let rect = {};
            rect.left = 0;
            rect.top = 0;
            rect.right = document.documentElement.clientWidth;
            rect.bottom = document.documentElement.clientHeight;
            let style = {};

            if (element instanceof HTMLElement) {
                rect = element.getBoundingClientRect();
                style = window.getComputedStyle(element);
            }

            const margin = {};
            margin.left = parseFloat(style.marginLeftWidth) || 0;
            margin.top = parseFloat(style.marginTopWidth) || 0;
            margin.right = parseFloat(style.marginRightWidth) || 0;
            margin.bottom = parseFloat(style.marginBottomWidth) || 0;

            const border = {};
            border.left = parseFloat(style.borderLeftWidth) || 0;
            border.top = parseFloat(style.borderTopWidth) || 0;
            border.right = parseFloat(style.borderRightWidth) || 0;
            border.bottom = parseFloat(style.borderBottomWidth) || 0;

            const newRect = {};
            newRect.left = rect.left + margin.left + border.left;
            newRect.top = rect.top + margin.top + border.top;
            newRect.right = rect.right + margin.right + border.right;
            newRect.bottom = rect.bottom + margin.bottom + border.bottom;
            newRect.width = newRect.right - newRect.left;
            newRect.height = newRect.bottom - newRect.top;

            return newRect;
        }

        // get list of elements after a start element up to element matching
        // query
        function nextUntil(element, query, exclude) {
            const elements = [];
            while (element = element.nextElementSibling, element) {
                if (element.matches(query))
                    break;
                if (!element.matches(exclude))
                    elements.push(element);
            }
            return elements;
        }

        // get closest element before specified element that matches query
        function firstBefore(element, query) {
            while (
                element &&
                element !== document.body &&
                !element.matches(query)
            )
                element = element.previousElementSibling || element.parentNode;

            return element;
        }

        // check if element is part of collapsed heading
        function isCollapsed(element) {
            while (element && element !== document.body) {
                if (element.dataset.collapsed === 'true')
                    return true;
                element = element.parentNode;
            }
            return false;
        }

        // expand heading containing element if necesary
        function expandElement(element) {
            if (isCollapsed(element)) {
                const heading = firstBefore(element, 'h2');
                if (heading)
                    heading.click();
            }
        }

        // load options from url parameters
        function loadOptions() {
            const url = window.location.search;
            const params = new URLSearchParams(url);
            for (const optionName of Object.keys(options)) {
                const paramName = pluginName + '-' + optionName;
                const param = params.get(paramName);
                if (param !== '' && param !== null)
                    options[optionName] = param;
            }
        }
        loadOptions();

        // start script when document is finished loading
        if (options.enabled === 'true')
            window.addEventListener('load', start);
    })();
</script>

<!-- angle down icon -->

<template class="icon_angle_down">
    <!-- modified from: https://fontawesome.com/icons/angle-down -->
    <svg width="16" height="16" viewBox="0 0 448 512">
        <path
            fill="currentColor"
            d="M207.029 381.476L12.686 187.132c-9.373-9.373-9.373-24.569 0-33.941l22.667-22.667c9.357-9.357 24.522-9.375 33.901-.04L224 284.505l154.745-154.021c9.379-9.335 24.544-9.317 33.901.04l22.667 22.667c9.373 9.373 9.373 24.569 0 33.941L240.971 381.476c-9.373 9.372-24.569 9.372-33.942 0z"
        ></path>
    </svg>
</template>
<!-- tooltips plugin -->

<script>
    (function() {
        // /////////////////////////
        // DESCRIPTION
        // /////////////////////////

        // This Manubot plugin makes it such that when the user hovers or
        // focuses a link to a citation or figure, a tooltip appears with a
        // preview of the reference content, along with arrows to navigate
        // between instances of the same reference in the document.

        // /////////////////////////
        // OPTIONS
        // /////////////////////////

        // plugin name prefix for url parameters
        const pluginName = 'tooltips';

        // default plugin options
        const options = {
            // whether user must click off to close tooltip instead of just
            // un-hovering
            clickClose: 'false',
            // delay (in ms) between opening and closing tooltip
            delay: '100',
            // whether plugin is on or not
            enabled: 'true'
        };

        // change options above, or override with url parameter, eg:
        // 'manuscript.html?pluginName-enabled=false'

        // /////////////////////////
        // SCRIPT
        // /////////////////////////

        // start script
        function start() {
            const links = getLinks();
            for (const link of links) {
                // attach hover and focus listeners to link
                link.addEventListener('mouseover', onLinkHover);
                link.addEventListener('mouseleave', onLinkUnhover);
                link.addEventListener('focus', onLinkFocus);
                link.addEventListener('touchend', onLinkTouch);
            }

            // attach mouse, key, and resize listeners to window
            window.addEventListener('mousedown', onClick);
            window.addEventListener('touchstart', onClick);
            window.addEventListener('keyup', onKeyUp);
            window.addEventListener('resize', onResize);
        }

        // when link is hovered
        function onLinkHover() {
            // function to open tooltip
            const delayOpenTooltip = function() {
                openTooltip(this);
            }.bind(this);

            // run open function after delay
            this.openTooltipTimer = window.setTimeout(
                delayOpenTooltip,
                options.delay
            );
        }

        // when mouse leaves link
        function onLinkUnhover() {
            // cancel opening tooltip
            window.clearTimeout(this.openTooltipTimer);

            // don't close on unhover if option specifies
            if (options.clickClose === 'true')
                return;

            // function to close tooltip
            const delayCloseTooltip = function() {
                // if tooltip open and if mouse isn't over tooltip, close
                const tooltip = document.getElementById('tooltip');
                if (tooltip && !tooltip.matches(':hover'))
                    closeTooltip();
            };

            // run close function after delay
            this.closeTooltipTimer = window.setTimeout(
                delayCloseTooltip,
                options.delay
            );
        }

        // when link is focused (tabbed to)
        function onLinkFocus(event) {
            openTooltip(this);
        }

        // when link is touched on touch screen
        function onLinkTouch(event) {
            // attempt to force hover state on first tap always, and trigger
            // regular link click (and navigation) on second tap
            if (event.target === document.activeElement)
                event.target.click();
            else {
                document.activeElement.blur();
                event.target.focus();
            }
            if (event.cancelable)
                event.preventDefault();
            event.stopPropagation();
            return false;
        }

        // when mouse is clicked anywhere in window
        function onClick(event) {
            closeTooltip();
        }

        // when key pressed
        function onKeyUp(event) {
            if (!event || !event.key)
                return;

            switch (event.key) {
                // trigger click of prev button
                case 'ArrowLeft':
                    const prevButton = document.getElementById(
                        'tooltip_prev_button'
                    );
                    if (prevButton)
                        prevButton.click();
                    break;
                // trigger click of next button
                case 'ArrowRight':
                    const nextButton = document.getElementById(
                        'tooltip_next_button'
                    );
                    if (nextButton)
                        nextButton.click();
                    break;
                // close on esc
                case 'Escape':
                    closeTooltip();
                    break;
            }
        }

        // when window is resized or zoomed
        function onResize() {
            closeTooltip();
        }

        // get all links of types we wish to handle
        function getLinks() {
            const queries = [];
            // exclude buttons, anchor links, toc links, etc
            const exclude =
                ':not(.button):not(.icon_button):not(.anchor):not(.toc_link)';
            queries.push('a[href^="#ref-"]' + exclude); // citation links
            queries.push('a[href^="#fig:"]' + exclude); // figure links
            const query = queries.join(', ');
            return document.querySelectorAll(query);
        }

        // get links with same target, get index of link in set, get total
        // same links
        function getSameLinks(link) {
            const sameLinks = [];
            const links = getLinks();
            for (const otherLink of links) {
                if (
                    otherLink.getAttribute('href') === link.getAttribute('href')
                )
                    sameLinks.push(otherLink);
            }

            return {
                elements: sameLinks,
                index: sameLinks.indexOf(link),
                total: sameLinks.length
            };
        }

        // open tooltip
        function openTooltip(link) {
            // delete tooltip if it exists, start fresh
            closeTooltip();

            // make tooltip element
            const tooltip = makeTooltip(link);

            // if source couldn't be found and tooltip not made, exit
            if (!tooltip)
                return;

            // make navbar elements
            const navBar = makeNavBar(link);
            if (navBar)
                tooltip.firstElementChild.appendChild(navBar);

            // attach tooltip to page
            document.body.appendChild(tooltip);

            // position tooltip
            const position = function() {
                positionTooltip(link);
            };
            position();

            // if tooltip contains images, position again after they've loaded
            const imgs = tooltip.querySelectorAll('img');
            for (const img of imgs)
                img.addEventListener('load', position);
        }

        // close (delete) tooltip
        function closeTooltip() {
            const tooltip = document.getElementById('tooltip');
            if (tooltip)
                tooltip.remove();
        }

        // make tooltip
        function makeTooltip(link) {
            // get target element that link points to
            const source = getSource(link);

            // if source can't be found, exit
            if (!source)
                return;

            // create new tooltip
            const tooltip = document.createElement('div');
            tooltip.id = 'tooltip';
            const tooltipContent = document.createElement('div');
            tooltipContent.id = 'tooltip_content';
            tooltip.appendChild(tooltipContent);

            // make copy of source node and put in tooltip
            const sourceCopy = makeCopy(source);
            tooltipContent.appendChild(sourceCopy);

            // attach mouse event listeners
            tooltip.addEventListener('click', onTooltipClick);
            tooltip.addEventListener('mousedown', onTooltipClick);
            tooltip.addEventListener('touchstart', onTooltipClick);
            tooltip.addEventListener('mouseleave', onTooltipUnhover);

            // (for interaction with lightbox plugin)
            // transfer click on tooltip copied img to original img
            const sourceImg = source.querySelector('img');
            const sourceCopyImg = sourceCopy.querySelector('img');
            if (sourceImg && sourceCopyImg) {
                const clickImg = function() {
                    sourceImg.click();
                    closeTooltip();
                };
                sourceCopyImg.addEventListener('click', clickImg);
            }

            return tooltip;
        }

        // make carbon copy of html dom element
        function makeCopy(source) {
            const sourceCopy = source.cloneNode(true);

            // delete elements marked with ignore (eg anchor and jump buttons)
            const deleteFromCopy = sourceCopy.querySelectorAll(
                '[data-ignore="true"]'
            );
            for (const element of deleteFromCopy)
                element.remove();

            // delete certain element attributes
            const attributes = [
                'id',
                'data-collapsed',
                'data-selected',
                'data-highlighted',
                'data-glow'
            ];
            for (const attribute of attributes) {
                sourceCopy.removeAttribute(attribute);
                const elements = sourceCopy.querySelectorAll(
                    '[' + attribute + ']'
                );
                for (const element of elements)
                    element.removeAttribute(attribute);
            }

            return sourceCopy;
        }

        // when tooltip is clicked
        function onTooltipClick(event) {
            // when user clicks on tooltip, stop click from transferring
            // outside of tooltip (eg, click off to close tooltip, or eg click
            // off to unhighlight same refs)
            event.stopPropagation();
        }

        // when tooltip is unhovered
        function onTooltipUnhover(event) {
            if (options.clickClose === 'true')
                return;

            // make sure new mouse/touch/focus no longer over tooltip or any
            // element within it
            const tooltip = document.getElementById('tooltip');
            if (!tooltip)
                return;
            if (this.contains(event.relatedTarget))
                return;

            closeTooltip();
        }

        // make nav bar to go betwen prev/next instances of same reference
        function makeNavBar(link) {
            // find other links to the same source
            const sameLinks = getSameLinks(link);

            // don't show nav bar when singular reference
            if (sameLinks.total <= 1)
                return;

            // find prev/next links with same target
            const prevLink = getPrevLink(link, sameLinks);
            const nextLink = getNextLink(link, sameLinks);

            // create nav bar
            const navBar = document.createElement('div');
            navBar.id = 'tooltip_nav_bar';
            const text = sameLinks.index + 1 + ' of ' + sameLinks.total;

            // create nav bar prev/next buttons
            const prevButton = document.createElement('button');
            const nextButton = document.createElement('button');
            prevButton.id = 'tooltip_prev_button';
            nextButton.id = 'tooltip_next_button';
            prevButton.title =
                'Jump to the previous occurence of this item in the document [←]';
            nextButton.title =
                'Jump to the next occurence of this item in the document [→]';
            prevButton.classList.add('icon_button');
            nextButton.classList.add('icon_button');
            prevButton.innerHTML = document.querySelector(
                '.icon_caret_left'
            ).innerHTML;
            nextButton.innerHTML = document.querySelector(
                '.icon_caret_right'
            ).innerHTML;
            navBar.appendChild(prevButton);
            navBar.appendChild(document.createTextNode(text));
            navBar.appendChild(nextButton);

            // attach click listeners to buttons
            prevButton.addEventListener('click', function() {
                onPrevNextClick(link, prevLink);
            });
            nextButton.addEventListener('click', function() {
                onPrevNextClick(link, nextLink);
            });

            return navBar;
        }

        // get previous link with same target
        function getPrevLink(link, sameLinks) {
            if (!sameLinks)
                sameLinks = getSameLinks(link);
            // wrap index to other side if < 1
            let index;
            if (sameLinks.index - 1 >= 0)
                index = sameLinks.index - 1;
            else
                index = sameLinks.total - 1;
            return sameLinks.elements[index];
        }

        // get next link with same target
        function getNextLink(link, sameLinks) {
            if (!sameLinks)
                sameLinks = getSameLinks(link);
            // wrap index to other side if > total
            let index;
            if (sameLinks.index + 1 <= sameLinks.total - 1)
                index = sameLinks.index + 1;
            else
                index = 0;
            return sameLinks.elements[index];
        }

        // get element that is target of link or url hash
        function getSource(link) {
            const hash = link ? link.hash : window.location.hash;
            const id = hash.slice(1);
            let target = document.querySelector('[id="' + id + '"]');
            if (!target)
                return;

            // if ref or figure, modify target to get expected element
            if (id.indexOf('ref-') === 0)
                target = target.querySelector('p');
            else if (id.indexOf('fig:') === 0)
                target = target.querySelector('figure');

            return target;
        }

        // when prev/next arrow button is clicked
        function onPrevNextClick(link, prevNextLink) {
            if (link && prevNextLink)
                goToElement(prevNextLink, window.innerHeight * 0.5);
        }

        // scroll to and focus element
        function goToElement(element, offset) {
            // expand accordion section if collapsed
            expandElement(element);
            const y =
                getRectInView(element).top -
                getRectInView(document.documentElement).top -
                (offset || 0);
            // trigger any function listening for "onscroll" event
            window.dispatchEvent(new Event('scroll'));
            window.scrollTo(0, y);
            document.activeElement.blur();
            element.focus();
        }

        // determine position to place tooltip based on link position in
        // viewport and tooltip size
        function positionTooltip(link, left, top) {
            const tooltipElement = document.getElementById('tooltip');
            if (!tooltipElement)
                return;

            // get convenient vars for position/dimensions of
            // link/tooltip/page/view
            link = getRectInPage(link);
            const tooltip = getRectInPage(tooltipElement);
            const view = getRectInPage();

            // horizontal positioning
            if (left)
                // use explicit value
                left = left;
            else if (link.left + tooltip.width < view.right)
                // fit tooltip to right of link
                left = link.left;
            else if (link.right - tooltip.width > view.left)
                // fit tooltip to left of link
                left = link.right - tooltip.width;
            // center tooltip in view
            else
                left = (view.right - view.left) / 2 - tooltip.width / 2;

            // vertical positioning
            if (top)
                // use explicit value
                top = top;
            else if (link.top - tooltip.height > view.top)
                // fit tooltip above link
                top = link.top - tooltip.height;
            else if (link.bottom + tooltip.height < view.bottom)
                // fit tooltip below link
                top = link.bottom;
            else {
                // center tooltip in view
                top = view.top + view.height / 2 - tooltip.height / 2;
                // nudge off of link to left/right if possible
                if (link.right + tooltip.width < view.right)
                    left = link.right;
                else if (link.left - tooltip.width > view.left)
                    left = link.left - tooltip.width;
            }

            tooltipElement.style.left = left + 'px';
            tooltipElement.style.top = top + 'px';
        }

        // get position/dimensions of element or viewport
        function getRectInView(element) {
            let rect = {};
            rect.left = 0;
            rect.top = 0;
            rect.right = document.documentElement.clientWidth;
            rect.bottom = document.documentElement.clientHeight;
            let style = {};

            if (element instanceof HTMLElement) {
                rect = element.getBoundingClientRect();
                style = window.getComputedStyle(element);
            }

            const margin = {};
            margin.left = parseFloat(style.marginLeftWidth) || 0;
            margin.top = parseFloat(style.marginTopWidth) || 0;
            margin.right = parseFloat(style.marginRightWidth) || 0;
            margin.bottom = parseFloat(style.marginBottomWidth) || 0;

            const border = {};
            border.left = parseFloat(style.borderLeftWidth) || 0;
            border.top = parseFloat(style.borderTopWidth) || 0;
            border.right = parseFloat(style.borderRightWidth) || 0;
            border.bottom = parseFloat(style.borderBottomWidth) || 0;

            const newRect = {};
            newRect.left = rect.left + margin.left + border.left;
            newRect.top = rect.top + margin.top + border.top;
            newRect.right = rect.right + margin.right + border.right;
            newRect.bottom = rect.bottom + margin.bottom + border.bottom;
            newRect.width = newRect.right - newRect.left;
            newRect.height = newRect.bottom - newRect.top;

            return newRect;
        }

        // get position of element relative to page
        function getRectInPage(element) {
            const rect = getRectInView(element);
            const body = getRectInView(document.body);

            const newRect = {};
            newRect.left = rect.left - body.left;
            newRect.top = rect.top - body.top;
            newRect.right = rect.right - body.left;
            newRect.bottom = rect.bottom - body.top;
            newRect.width = rect.width;
            newRect.height = rect.height;

            return newRect;
        }

        // (for interaction with accordion plugin)
        // get closest element before specified element that matches query
        function firstBefore(element, query) {
            while (
                element &&
                element !== document.body &&
                !element.matches(query)
            )
                element = element.previousElementSibling || element.parentNode;

            return element;
        }

        // (for interaction with accordion plugin)
        // check if element is part of collapsed heading
        function isCollapsed(element) {
            while (element && element !== document.body) {
                if (element.dataset.collapsed === 'true')
                    return true;
                element = element.parentNode;
            }
            return false;
        }

        // (for interaction with accordion plugin)
        // expand heading containing element if necesary
        function expandElement(element) {
            if (isCollapsed(element)) {
                const heading = firstBefore(element, 'h2');
                if (heading)
                    heading.click();
            }
        }

        // load options from url parameters
        function loadOptions() {
            const url = window.location.search;
            const params = new URLSearchParams(url);
            for (const optionName of Object.keys(options)) {
                const paramName = pluginName + '-' + optionName;
                const param = params.get(paramName);
                if (param !== '' && param !== null)
                    options[optionName] = param;
            }
        }
        loadOptions();

        // start script when document is finished loading
        if (options.enabled === 'true')
            window.addEventListener('load', start);
    })();
</script>

<!-- caret left icon -->

<template class="icon_caret_left">
    <!-- modified from: https://fontawesome.com/icons/caret-left -->
    <svg width="16" height="16" viewBox="0 0 192 512">
        <path
            fill="currentColor"
            d="M192 127.338v257.324c0 17.818-21.543 26.741-34.142 14.142L29.196 270.142c-7.81-7.81-7.81-20.474 0-28.284l128.662-128.662c12.599-12.6 34.142-3.676 34.142 14.142z"
        ></path>
    </svg>
</template>

<!-- caret right icon -->

<template class="icon_caret_right">
    <!-- modified from: https://fontawesome.com/icons/caret-right -->
    <svg width="16" height="16" viewBox="0 0 192 512">
        <path
            fill="currentColor"
            d="M0 384.662V127.338c0-17.818 21.543-26.741 34.142-14.142l128.662 128.662c7.81 7.81 7.81 20.474 0 28.284L34.142 398.804C21.543 411.404 0 402.48 0 384.662z"
        ></path>
    </svg>
</template>
<!-- jump to first plugin -->

<script>
    (function() {
        // /////////////////////////
        // DESCRIPTION
        // /////////////////////////

        // This Manubot plugin adds a button next to each reference entry,
        // figure, and table that jumps the page to the first occurrence of a
        // link to that item in the manuscript.

        // /////////////////////////
        // OPTIONS
        // /////////////////////////

        // plugin name prefix for url parameters
        const pluginName = 'jumpToFirst';

        // default plugin options
        const options = {
            // whether to add buttons next to reference entries
            references: 'true',
            // whether to add buttons next to figures
            figures: 'true',
            // whether to add buttons next to tables
            tables: 'true',
            // whether plugin is on or not
            enabled: 'true'
        };

        // change options above, or override with url parameter, eg:
        // 'manuscript.html?pluginName-enabled=false'

        // /////////////////////////
        // SCRIPT
        // /////////////////////////

        // start script
        function start() {
            if (options.references !== 'false')
                makeReferenceButtons();
            if (options.figures !== 'false')
                makeFigureButtons();
            if (options.tables !== 'false')
                makeTableButtons();
        }

        // when jump button clicked
        function onButtonClick() {
            const first = getFirstOccurrence(this.dataset.id);
            if (!first)
                return;

            // update url hash so navigating "back" in history will return
            // user to jump button
            window.location.hash = this.dataset.id;
            // scroll to link
            window.setTimeout(function() {
                goToElement(first, window.innerHeight * 0.5);
            }, 0);
        }

        // get first occurence of link to item in document
        function getFirstOccurrence(id) {
            let query = 'a';
            query += '[href="#' + id + '"]';
            // exclude buttons, anchor links, toc links, etc
            query +=
                ':not(.button):not(.icon_button):not(.anchor):not(.toc_link)';
            return document.querySelector(query);
        }

        // add button next to each reference entry
        function makeReferenceButtons() {
            const references = document.querySelectorAll('div[id^="ref-"]');
            for (const reference of references) {
                // get reference id and element to add button to
                const id = reference.id;
                const container = reference.firstElementChild;
                const first = getFirstOccurrence(id);

                // if can't find link to reference, ignore
                if (!first)
                    continue;

                // make jump button
                let button = document.createElement('button');
                button.classList.add('icon_button', 'jump_arrow');
                button.title =
                    'Jump to the first occurence of this reference in the document';
                button.innerHTML = document.querySelector(
                    '.icon_angle_double_up'
                ).innerHTML;
                button.dataset.id = id;
                button.dataset.ignore = 'true';
                container.innerHTML = button.outerHTML + container.innerHTML;
                button = container.firstElementChild;
                button.addEventListener('click', onButtonClick);
            }
        }

        // add button next to each figure
        function makeFigureButtons() {
            const figures = document.querySelectorAll('[id^="fig:"]');
            for (const figure of figures) {
                // get figure id and element to add button to
                const id = figure.id;
                const container = figure.querySelector('figcaption') || figure;
                const first = getFirstOccurrence(id);

                // if can't find link to figure, ignore
                if (!first)
                    continue;

                // make jump button
                const button = document.createElement('button');
                button.classList.add('icon_button', 'jump_arrow');
                button.title =
                    'Jump to the first occurence of this figure in the document';
                button.innerHTML = document.querySelector(
                    '.icon_angle_double_up'
                ).innerHTML;
                button.dataset.id = id;
                button.dataset.ignore = 'true';
                container.insertBefore(button, container.firstElementChild);
                button.addEventListener('click', onButtonClick);
            }
        }

        // add button next to each figure
        function makeTableButtons() {
            const tables = document.querySelectorAll('[id^="tbl:"]');
            for (const table of tables) {
                // get ref id and element to add button to
                const id = table.id;
                const container = table.querySelector('caption') || table;
                const first = getFirstOccurrence(id);

                // if can't find link to table, ignore
                if (!first)
                    continue;

                // make jump button
                const button = document.createElement('button');
                button.classList.add('icon_button', 'jump_arrow');
                button.title =
                    'Jump to the first occurence of this table in the document';
                button.innerHTML = document.querySelector(
                    '.icon_angle_double_up'
                ).innerHTML;
                button.dataset.id = id;
                button.dataset.ignore = 'true';
                container.insertBefore(button, container.firstElementChild);
                button.addEventListener('click', onButtonClick);
            }
        }

        // scroll to and focus element
        function goToElement(element, offset) {
            // expand accordion section if collapsed
            expandElement(element);
            const y =
                getRectInView(element).top -
                getRectInView(document.documentElement).top -
                (offset || 0);
            // trigger any function listening for "onscroll" event
            window.dispatchEvent(new Event('scroll'));
            window.scrollTo(0, y);
            document.activeElement.blur();
            element.focus();
        }

        // get position/dimensions of element or viewport
        function getRectInView(element) {
            let rect = {};
            rect.left = 0;
            rect.top = 0;
            rect.right = document.documentElement.clientWidth;
            rect.bottom = document.documentElement.clientHeight;
            let style = {};

            if (element instanceof HTMLElement) {
                rect = element.getBoundingClientRect();
                style = window.getComputedStyle(element);
            }

            const margin = {};
            margin.left = parseFloat(style.marginLeftWidth) || 0;
            margin.top = parseFloat(style.marginTopWidth) || 0;
            margin.right = parseFloat(style.marginRightWidth) || 0;
            margin.bottom = parseFloat(style.marginBottomWidth) || 0;

            const border = {};
            border.left = parseFloat(style.borderLeftWidth) || 0;
            border.top = parseFloat(style.borderTopWidth) || 0;
            border.right = parseFloat(style.borderRightWidth) || 0;
            border.bottom = parseFloat(style.borderBottomWidth) || 0;

            const newRect = {};
            newRect.left = rect.left + margin.left + border.left;
            newRect.top = rect.top + margin.top + border.top;
            newRect.right = rect.right + margin.right + border.right;
            newRect.bottom = rect.bottom + margin.bottom + border.bottom;
            newRect.width = newRect.right - newRect.left;
            newRect.height = newRect.bottom - newRect.top;

            return newRect;
        }

        // get closest element before specified element that matches query
        function firstBefore(element, query) {
            while (
                element &&
                element !== document.body &&
                !element.matches(query)
            )
                element = element.previousElementSibling || element.parentNode;

            return element;
        }

        // check if element is part of collapsed heading
        function isCollapsed(element) {
            while (element && element !== document.body) {
                if (element.dataset.collapsed === 'true')
                    return true;
                element = element.parentNode;
            }
            return false;
        }

        // (for interaction with accordion plugin)
        // expand heading containing element if necesary
        function expandElement(element) {
            if (isCollapsed(element)) {
                const heading = firstBefore(element, 'h2');
                if (heading)
                    heading.click();
            }
        }

        // load options from url parameters
        function loadOptions() {
            const url = window.location.search;
            const params = new URLSearchParams(url);
            for (const optionName of Object.keys(options)) {
                const paramName = pluginName + '-' + optionName;
                const param = params.get(paramName);
                if (param !== '' && param !== null)
                    options[optionName] = param;
            }
        }
        loadOptions();

        // start script when document is finished loading
        if (options.enabled === 'true')
            window.addEventListener('load', start);
    })();
</script>

<!-- angle double up icon -->

<template class="icon_angle_double_up">
    <!-- modified from: https://fontawesome.com/icons/angle-double-up -->
    <svg width="16" height="16" viewBox="0 0 320 512">
        <path
            fill="currentColor"
            d="M177 255.7l136 136c9.4 9.4 9.4 24.6 0 33.9l-22.6 22.6c-9.4 9.4-24.6 9.4-33.9 0L160 351.9l-96.4 96.4c-9.4 9.4-24.6 9.4-33.9 0L7 425.7c-9.4-9.4-9.4-24.6 0-33.9l136-136c9.4-9.5 24.6-9.5 34-.1zm-34-192L7 199.7c-9.4 9.4-9.4 24.6 0 33.9l22.6 22.6c9.4 9.4 24.6 9.4 33.9 0l96.4-96.4 96.4 96.4c9.4 9.4 24.6 9.4 33.9 0l22.6-22.6c9.4-9.4 9.4-24.6 0-33.9l-136-136c-9.2-9.4-24.4-9.4-33.8 0z"
        ></path>
    </svg>
</template>
<!-- link highlight plugin -->

<script>
    (function() {
        // /////////////////////////
        // DESCRIPTION
        // /////////////////////////

        // This Manubot plugin makes it such that when a user hovers or
        // focuses a link, other links that have the same target will be
        // highlighted. It also makes it such that when clicking a link, the
        // target of the link (eg reference, figure, table) is briefly
        // highlighted.

        // /////////////////////////
        // OPTIONS
        // /////////////////////////

        // plugin name prefix for url parameters
        const pluginName = 'linkHighlight';

        // default plugin options
        const options = {
            // whether to also highlight links that go to external urls
            externalLinks: 'false',
            // whether user must click off to unhighlight instead of just
            // un-hovering
            clickUnhighlight: 'false',
            // whether to also highlight links that are unique
            highlightUnique: 'true',
            // whether plugin is on or not
            enabled: 'true'
        };

        // change options above, or override with url parameter, eg:
        // 'manuscript.html?pluginName-enabled=false'

        // /////////////////////////
        // SCRIPT
        // /////////////////////////

        // start script
        function start() {
            const links = getLinks();
            for (const link of links) {
                // attach mouse and focus listeners to link
                link.addEventListener('mouseenter', onLinkFocus);
                link.addEventListener('focus', onLinkFocus);
                link.addEventListener('mouseleave', onLinkUnhover);
            }

            // attach click and hash change listeners to window
            window.addEventListener('click', onClick);
            window.addEventListener('touchstart', onClick);
            window.addEventListener('hashchange', onHashChange);

            // run hash change on window load in case user has navigated
            // directly to hash
            onHashChange();
        }

        // when link is focused (tabbed to) or hovered
        function onLinkFocus() {
            highlight(this);
        }

        // when link is unhovered
        function onLinkUnhover() {
            if (options.clickUnhighlight !== 'true')
                unhighlightAll();
        }

        // when the mouse is clicked anywhere in window
        function onClick(event) {
            unhighlightAll();
        }

        // when hash (eg manuscript.html#introduction) changes
        function onHashChange() {
            const target = getHashTarget();
            if (target)
                glowElement(target);
        }

        // get element that is target of link or url hash
        function getHashTarget(link) {
            const hash = link ? link.hash : window.location.hash;
            const id = hash.slice(1);
            let target = document.querySelector('[id="' + id + '"]');
            if (!target)
                return;

            return target;
        }

        // start glow sequence on an element
        function glowElement(element) {
            const startGlow = function() {
                onGlowEnd();
                element.dataset.glow = 'true';
                element.addEventListener('animationend', onGlowEnd);
            };
            const onGlowEnd = function() {
                element.removeAttribute('data-glow');
                element.removeEventListener('animationend', onGlowEnd);
            };
            startGlow();
        }

        // highlight link and all others with same target
        function highlight(link) {
            // force unhighlight all to start fresh
            unhighlightAll();

            // get links with same target
            if (!link)
                return;
            const sameLinks = getSameLinks(link);

            // if link unique and option is off, exit and don't highlight
            if (sameLinks.length <= 1 && options.highlightUnique !== 'true')
                return;

            // highlight all same links, and "select" (special highlight) this
            // one
            for (const sameLink of sameLinks) {
                if (sameLink === link)
                    sameLink.setAttribute('data-selected', 'true');
                else
                    sameLink.setAttribute('data-highlighted', 'true');
            }
        }

        // unhighlight all links
        function unhighlightAll() {
            const links = getLinks();
            for (const link of links) {
                link.setAttribute('data-selected', 'false');
                link.setAttribute('data-highlighted', 'false');
            }
        }

        // get links with same target
        function getSameLinks(link) {
            const results = [];
            const links = getLinks();
            for (const otherLink of links) {
                if (
                    otherLink.getAttribute('href') === link.getAttribute('href')
                )
                    results.push(otherLink);
            }
            return results;
        }

        // get all links of types we wish to handle
        function getLinks() {
            let query = 'a';
            if (options.externalLinks !== 'true')
                query += '[href^="#"]';
            // exclude buttons, anchor links, toc links, etc
            query +=
                ':not(.button):not(.icon_button):not(.anchor):not(.toc_link)';
            return document.querySelectorAll(query);
        }

        // load options from url parameters
        function loadOptions() {
            const url = window.location.search;
            const params = new URLSearchParams(url);
            for (const optionName of Object.keys(options)) {
                const paramName = pluginName + '-' + optionName;
                const param = params.get(paramName);
                if (param !== '' && param !== null)
                    options[optionName] = param;
            }
        }
        loadOptions();

        // start script when document is finished loading
        if (options.enabled === 'true')
            window.addEventListener('load', start);
    })();
</script>
<script>
    (function() {
        // /////////////////////////
        // DESCRIPTION
        // /////////////////////////

        // This Manubot plugin provides a "table of contents" (toc) panel on
        // the side of the document that allows the user to conveniently
        // navigate between sections of the document.

        // /////////////////////////
        // OPTIONS
        // /////////////////////////

        // plugin name prefix for url parameters
        const pluginName = 'tableOfContents';

        // default plugin options
        const options = {
            // which types of elements to add links for, in
            // "document.querySelector" format
            typesQuery: 'h1, h2, h3',
            // whether toc starts open. use 'true' or 'false', or 'auto' to
            // use 'true' behavior when screen wide enough and 'false' when not
            startOpen: 'false',
            // whether toc closes when clicking on toc link. use 'true' or
            // 'false', or 'auto' to use 'false' behavior when screen wide
            // enough and 'true' when not
            clickClose: 'auto',
            // if list item is more than this many characters, text will be
            // truncated
            charLimit: '50',
            // whether or not to show bullets next to each toc item
            bullets: 'false',
            // whether plugin is on or not
            enabled: 'true'
        };

        // change options above, or override with url parameter, eg:
        // 'manuscript.html?pluginName-enabled=false'

        // /////////////////////////
        // SCRIPT
        // /////////////////////////

        // start script
        function start() {
            // make toc panel and populate with entries (links to document
            // sections)
            const panel = makePanel();
            if (!panel)
                return;
            makeEntries(panel);
            // attach panel to document after making entries, so 'toc' heading
            // in panel isn't included in toc
            document.body.insertBefore(panel, document.body.firstChild);

            // initial panel state
            if (
                options.startOpen === 'true' ||
                (options.startOpen === 'auto' && !isSmallScreen())
            )
                openPanel();
            else
                closePanel();

            // attach click, scroll, and hash change listeners to window
            window.addEventListener('click', onClick);
            window.addEventListener('scroll', onScroll);
            window.addEventListener('hashchange', onScroll);
            window.addEventListener('keyup', onKeyUp);
            onScroll();

            // add class to push document body down out of way of toc button
            document.body.classList.add('toc_body_nudge');
        }

        // determine if screen wide enough to fit toc panel
        function isSmallScreen() {
            // in default theme:
            // 816px = 8.5in = width of "page" (<body>) element
            // 260px = min width of toc panel (*2 for both sides of <body>)
            return window.innerWidth < 816 + 260 * 2;
        }

        // when mouse is clicked anywhere in window
        function onClick() {
            if (isSmallScreen())
                closePanel();
        }

        // when window is scrolled or hash changed
        function onScroll() {
            highlightViewed();
        }

        // when key pressed
        function onKeyUp(event) {
            if (!event || !event.key)
                return;

            // close on esc
            if (event.key === 'Escape')
                closePanel();
        }

        // find entry of currently viewed document section in toc and highlight
        function highlightViewed() {
            const firstId = getFirstInView(options.typesQuery);

            // get toc entries (links), unhighlight all, then highlight viewed
            const list = document.getElementById('toc_list');
            if (!firstId || !list)
                return;
            const links = list.querySelectorAll('a');
            for (const link of links)
                link.dataset.viewing = 'false';
            const link = list.querySelector('a[href="#' + firstId + '"]');
            if (!link)
                return;
            link.dataset.viewing = 'true';
        }

        // get first or previous toc listed element in top half of view
        function getFirstInView(query) {
            // get all elements matching query and with id
            const elements = document.querySelectorAll(query);
            const elementsWithIds = [];
            for (const element of elements) {
                if (element.id)
                    elementsWithIds.push(element);
            }


            // get first or previous element in top half of view
            for (let i = 0; i < elementsWithIds.length; i++) {
                const element = elementsWithIds[i];
                const prevElement = elementsWithIds[Math.max(0, i - 1)];
                if (element.getBoundingClientRect().top >= 0) {
                    if (
                        element.getBoundingClientRect().top <
                        window.innerHeight / 2
                    )
                        return element.id;
                    else
                        return prevElement.id;
                }
            }
        }

        // make panel
        function makePanel() {
            // create panel
            const panel = document.createElement('div');
            panel.id = 'toc_panel';
            if (options.bullets === 'true')
                panel.dataset.bullets = 'true';

            // create header
            const header = document.createElement('div');
            header.id = 'toc_header';

            // create toc button
            const button = document.createElement('button');
            button.id = 'toc_button';
            button.innerHTML = document.querySelector('.icon_th_list').innerHTML;
            button.title = 'Table of Contents';
            button.classList.add('icon_button');

            // create header text
            const text = document.createElement('h4');
            text.innerHTML = 'Table of Contents';

            // create container for toc list
            const list = document.createElement('div');
            list.id = 'toc_list';

            // attach click listeners
            panel.addEventListener('click', onPanelClick);
            header.addEventListener('click', onHeaderClick);
            button.addEventListener('click', onButtonClick);

            // attach elements
            header.appendChild(button);
            header.appendChild(text);
            panel.appendChild(header);
            panel.appendChild(list);

            return panel;
        }

        // create toc entries (links) to each element of the specified types
        function makeEntries(panel) {
            const elements = document.querySelectorAll(options.typesQuery);
            for (const element of elements) {
                // do not add link if element doesn't have assigned id
                if (!element.id)
                    continue;

                // create link/list item
                const link = document.createElement('a');
                link.classList.add('toc_link');
                switch (element.tagName.toLowerCase()) {
                    case 'h1':
                        link.dataset.level = '1';
                        break;
                    case 'h2':
                        link.dataset.level = '2';
                        break;
                    case 'h3':
                        link.dataset.level = '3';
                        break;
                    case 'h4':
                        link.dataset.level = '4';
                        break;
                }
                link.title = element.innerText;
                let text = element.innerText;
                if (text.length > options.charLimit)
                    text = text.slice(0, options.charLimit) + '...';
                link.innerHTML = text;
                link.href = '#' + element.id;
                link.addEventListener('click', onLinkClick);

                // attach link
                panel.querySelector('#toc_list').appendChild(link);
            }
        }

        // when panel is clicked
        function onPanelClick(event) {
            // stop click from propagating to window/document and closing panel
            event.stopPropagation();
        }

        // when header itself is clicked
        function onHeaderClick(event) {
            togglePanel();
        }

        // when button is clicked
        function onButtonClick(event) {
            togglePanel();
            // stop header underneath button from also being clicked
            event.stopPropagation();
        }

        // when link is clicked
        function onLinkClick(event) {
            if (
                options.clickClose === 'true' ||
                (options.clickClose === 'auto' && isSmallScreen())
            )
                closePanel();
            else
                openPanel();
        }

        // open panel if closed, close if opened
        function togglePanel() {
            const panel = document.getElementById('toc_panel');
            if (!panel)
                return;

            if (panel.dataset.open === 'true')
                closePanel();
            else
                openPanel();
        }

        // open panel
        function openPanel() {
            const panel = document.getElementById('toc_panel');
            if (panel)
                panel.dataset.open = 'true';
        }

        // close panel
        function closePanel() {
            const panel = document.getElementById('toc_panel');
            if (panel)
                panel.dataset.open = 'false';
        }

        // load options from url parameters
        function loadOptions() {
            const url = window.location.search;
            const params = new URLSearchParams(url);
            for (const optionName of Object.keys(options)) {
                const paramName = pluginName + '-' + optionName;
                const param = params.get(paramName);
                if (param !== '' && param !== null)
                    options[optionName] = param;
            }
        }
        loadOptions();

        // start script when document is finished loading
        if (options.enabled === 'true')
            window.addEventListener('load', start);
    })();
</script>

<!-- th list icon -->

<template class="icon_th_list">
    <!-- modified from: https://fontawesome.com/icons/th-list -->
    <svg width="16" height="16" viewBox="0 0 512 512" tabindex="-1">
        <path
            fill="currentColor"
            d="M96 96c0 26.51-21.49 48-48 48S0 122.51 0 96s21.49-48 48-48 48 21.49 48 48zM48 208c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48zm0 160c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48zm96-236h352c8.837 0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H144c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h352c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H144c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h352c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H144c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z"
            tabindex="-1"
        ></path>
    </svg>
</template>
<!-- lightbox plugin -->

<script>
    (function() {
        // /////////////////////////
        // DESCRIPTION
        // /////////////////////////

        // This Manubot plugin makes it such that when a user clicks on an
        // image, the image fills the screen and the user can pan/drag/zoom
        // the image and navigate between other images in the document.

        // /////////////////////////
        // OPTIONS
        // /////////////////////////

        // plugin name prefix for url parameters
        const pluginName = 'lightbox';

        // default plugin options
        const options = {
            // list of possible zoom/scale factors
            zoomSteps:
                '0.1, 0.25, 0.333333, 0.5, 0.666666, 0.75, 1,' +
                '1.25, 1.5, 1.75, 2, 2.5, 3, 3.5, 4, 5, 6, 7, 8',
            // whether to fit image to view ('fit'), display at 100% and shrink
            // if necessary ('shrink'), or always display at 100% ('100')
            defaultZoom: 'fit',
            // whether to zoom in/out toward center of view ('true') or mouse
            // ('false')
            centerZoom: 'false',
            // whether plugin is on or not
            enabled: 'true'
        };

        // change options above, or override with url parameter, eg:
        // 'manuscript.html?pluginName-enabled=false'

        // /////////////////////////
        // SCRIPT
        // /////////////////////////

        // start script
        function start() {
            // run through each <img> element
            const imgs = document.querySelectorAll('figure > img');
            let count = 1;
            for (const img of imgs) {
                img.classList.add('lightbox_document_img');
                img.dataset.number = count;
                img.dataset.total = imgs.length;
                img.addEventListener('click', openLightbox);
                count++;
            }

            // attach mouse and key listeners to window
            window.addEventListener('mousemove', onWindowMouseMove);
            window.addEventListener('keyup', onKeyUp);
        }

        // when mouse is moved anywhere in window
        function onWindowMouseMove(event) {
            window.mouseX = event.clientX;
            window.mouseY = event.clientY;
        }

        // when key pressed
        function onKeyUp(event) {
            if (!event || !event.key)
                return;

            switch (event.key) {
                // trigger click of prev button
                case 'ArrowLeft':
                    const prevButton = document.getElementById(
                        'lightbox_prev_button'
                    );
                    if (prevButton)
                        prevButton.click();
                    break;
                // trigger click of next button
                case 'ArrowRight':
                    const nextButton = document.getElementById(
                        'lightbox_next_button'
                    );
                    if (nextButton)
                        nextButton.click();
                    break;
                // close on esc
                case 'Escape':
                    closeLightbox();
                    break;
            }
        }

        // open lightbox
        function openLightbox() {
            const lightbox = makeLightbox(this);
            if (!lightbox)
                return;

            blurBody(lightbox);
            document.body.appendChild(lightbox);
        }

        // make lightbox
        function makeLightbox(img) {
            // delete lightbox if it exists, start fresh
            closeLightbox();

            // create screen overlay containing lightbox
            const overlay = document.createElement('div');
            overlay.id = 'lightbox_overlay';

            // create image info boxes
            const numberInfo = document.createElement('div');
            const zoomInfo = document.createElement('div');
            numberInfo.id = 'lightbox_number_info';
            zoomInfo.id = 'lightbox_zoom_info';

            // create container for image
            const imageContainer = document.createElement('div');
            imageContainer.id = 'lightbox_image_container';
            const lightboxImg = makeLightboxImg(
                img,
                imageContainer,
                numberInfo,
                zoomInfo
            );
            imageContainer.appendChild(lightboxImg);

            // create bottom container for caption and navigation buttons
            const bottomContainer = document.createElement('div');
            bottomContainer.id = 'lightbox_bottom_container';
            const caption = makeCaption(img);
            const prevButton = makePrevButton(img);
            const nextButton = makeNextButton(img);
            bottomContainer.appendChild(prevButton);
            bottomContainer.appendChild(caption);
            bottomContainer.appendChild(nextButton);

            // attach top middle and bottom to overlay
            overlay.appendChild(numberInfo);
            overlay.appendChild(zoomInfo);
            overlay.appendChild(imageContainer);
            overlay.appendChild(bottomContainer);

            return overlay;
        }

        // make <img> object that is intuitively draggable and zoomable
        function makeLightboxImg(
            sourceImg,
            container,
            numberInfoBox,
            zoomInfoBox
        ) {
            // create copy of source <img>
            const img = sourceImg.cloneNode(true);
            img.classList.remove('lightbox_document_img');
            img.removeAttribute('id');
            img.removeAttribute('width');
            img.removeAttribute('height');
            img.style.position = 'unset';
            img.style.margin = '0';
            img.style.padding = '0';
            img.style.width = '';
            img.style.height = '';
            img.style.minWidth = '';
            img.style.minHeight = '';
            img.style.maxWidth = '';
            img.style.maxHeight = '';
            img.id = 'lightbox_img';

            // build sorted list of unique zoomSteps, always including a 100%
            let zoomSteps = [];
            const optionsZooms = options.zoomSteps.split(/[^0-9.]/);
            for (const optionZoom of optionsZooms) {
                const newZoom = parseFloat(optionZoom);
                if (newZoom && !zoomSteps.includes(newZoom))
                    zoomSteps.push(newZoom);
            }
            if (!zoomSteps.includes(1))
                zoomSteps.push(1);
            zoomSteps = zoomSteps.sort(function sortNumber(a, b) {
                return a - b;
            });

            // <img> object property variables
            let zoom = 1;
            let translateX = 0;
            let translateY = 0;
            let clickMouseX = undefined;
            let clickMouseY = undefined;
            let clickTranslateX = undefined;
            let clickTranslateY = undefined;

            updateNumberInfo();

            // update image numbers displayed in info box
            function updateNumberInfo() {
                numberInfoBox.innerHTML =
                    sourceImg.dataset.number + ' of ' + sourceImg.dataset.total;
            }

            // update zoom displayed in info box
            function updateZoomInfo() {
                let zoomInfo = zoom * 100;
                if (!Number.isInteger(zoomInfo))
                    zoomInfo = zoomInfo.toFixed(2);
                zoomInfoBox.innerHTML = zoomInfo + '%';
            }

            // move to closest zoom step above current zoom
            const zoomIn = function() {
                for (const zoomStep of zoomSteps) {
                    if (zoomStep > zoom) {
                        zoom = zoomStep;
                        break;
                    }
                }
                updateTransform();
            };

            // move to closest zoom step above current zoom
            const zoomOut = function() {
                zoomSteps.reverse();
                for (const zoomStep of zoomSteps) {
                    if (zoomStep < zoom) {
                        zoom = zoomStep;
                        break;
                    }
                }
                zoomSteps.reverse();

                updateTransform();
            };

            // update display of <img> based on scale/translate properties
            const updateTransform = function() {
                // set transform
                img.style.transform =
                    'translate(' +
                    (translateX || 0) +
                    'px,' +
                    (translateY || 0) +
                    'px) scale(' +
                    (zoom || 1) +
                    ')';

                // get new width/height after scale
                const rect = img.getBoundingClientRect();
                // limit translate
                translateX = Math.max(translateX, -rect.width / 2);
                translateX = Math.min(translateX, rect.width / 2);
                translateY = Math.max(translateY, -rect.height / 2);
                translateY = Math.min(translateY, rect.height / 2);

                // set transform
                img.style.transform =
                    'translate(' +
                    (translateX || 0) +
                    'px,' +
                    (translateY || 0) +
                    'px) scale(' +
                    (zoom || 1) +
                    ')';

                updateZoomInfo();
            };

            // fit <img> to container
            const fit = function() {
                // no x/y offset, 100% zoom by default
                translateX = 0;
                translateY = 0;
                zoom = 1;

                // widths of <img> and container
                const imgWidth = img.naturalWidth;
                const imgHeight = img.naturalHeight;
                const containerWidth = parseFloat(
                    window.getComputedStyle(container).width
                );
                const containerHeight = parseFloat(
                    window.getComputedStyle(container).height
                );

                // how much zooming is needed to fit <img> to container
                const xRatio = imgWidth / containerWidth;
                const yRatio = imgHeight / containerHeight;
                const maxRatio = Math.max(xRatio, yRatio);
                const newZoom = 1 / maxRatio;

                // fit <img> to container according to option
                if (options.defaultZoom === 'shrink') {
                    if (maxRatio > 1)
                        zoom = newZoom;
                } else if (options.defaultZoom === 'fit')
                    zoom = newZoom;

                updateTransform();
            };

            // when mouse wheel is rolled anywhere in container
            const onContainerWheel = function(event) {
                if (!event)
                    return;

                // let ctrl + mouse wheel to zoom behave as normal
                if (event.ctrlKey)
                    return;

                // prevent normal scroll behavior
                event.preventDefault();
                event.stopPropagation();

                // point around which to scale img
                const viewRect = container.getBoundingClientRect();
                const viewX = (viewRect.left + viewRect.right) / 2;
                const viewY = (viewRect.top + viewRect.bottom) / 2;
                const originX = options.centerZoom === 'true' ? viewX : mouseX;
                const originY = options.centerZoom === 'true' ? viewY : mouseY;

                // get point on image under origin
                const oldRect = img.getBoundingClientRect();
                const oldPercentX = (originX - oldRect.left) / oldRect.width;
                const oldPercentY = (originY - oldRect.top) / oldRect.height;

                // increment/decrement zoom
                if (event.deltaY < 0)
                    zoomIn();
                if (event.deltaY > 0)
                    zoomOut();

                // get offset between previous image point and origin
                const newRect = img.getBoundingClientRect();
                const offsetX =
                    originX - (newRect.left + newRect.width * oldPercentX);
                const offsetY =
                    originY - (newRect.top + newRect.height * oldPercentY);

                // translate image to keep image point under origin
                translateX += offsetX;
                translateY += offsetY;

                // perform translate
                updateTransform();
            };

            // when container is clicked
            function onContainerClick(event) {
                // if container itself is target of click, and not other
                // element above it
                if (event.target === this)
                    closeLightbox();
            }

            // when mouse button is pressed on image
            const onImageMouseDown = function(event) {
                // store original mouse position relative to image
                clickMouseX = window.mouseX;
                clickMouseY = window.mouseY;
                clickTranslateX = translateX;
                clickTranslateY = translateY;
                event.stopPropagation();
                event.preventDefault();
            };

            // when mouse button is released anywhere in window
            const onWindowMouseUp = function(event) {
                // reset original mouse position
                clickMouseX = undefined;
                clickMouseY = undefined;
                clickTranslateX = undefined;
                clickTranslateY = undefined;

                // remove global listener if lightbox removed from document
                if (!document.body.contains(container))
                    window.removeEventListener('mouseup', onWindowMouseUp);
            };

            // when mouse is moved anywhere in window
            const onWindowMouseMove = function(event) {
                if (
                    clickMouseX === undefined ||
                    clickMouseY === undefined ||
                    clickTranslateX === undefined ||
                    clickTranslateY === undefined
                )
                    return;

                // offset image based on original and current mouse position
                translateX = clickTranslateX + window.mouseX - clickMouseX;
                translateY = clickTranslateY + window.mouseY - clickMouseY;
                updateTransform();
                event.preventDefault();

                // remove global listener if lightbox removed from document
                if (!document.body.contains(container))
                    window.removeEventListener('mousemove', onWindowMouseMove);
            };

            // when window is resized
            const onWindowResize = function(event) {
                fit();

                // remove global listener if lightbox removed from document
                if (!document.body.contains(container))
                    window.removeEventListener('resize', onWindowResize);
            };

            // attach the necessary event listeners
            img.addEventListener('dblclick', fit);
            img.addEventListener('mousedown', onImageMouseDown);
            container.addEventListener('wheel', onContainerWheel);
            container.addEventListener('mousedown', onContainerClick);
            container.addEventListener('touchstart', onContainerClick);
            window.addEventListener('mouseup', onWindowMouseUp);
            window.addEventListener('mousemove', onWindowMouseMove);
            window.addEventListener('resize', onWindowResize);

            // run fit() after lightbox atttached to document and <img> Loaded
            // so needed container and img dimensions available
            img.addEventListener('load', fit);

            return img;
        }

        // make caption
        function makeCaption(img) {
            const caption = document.createElement('div');
            caption.id = 'lightbox_caption';
            const captionSource = img.nextElementSibling;
            if (captionSource.tagName.toLowerCase() === 'figcaption') {
                const captionCopy = makeCopy(captionSource);
                caption.innerHTML = captionCopy.innerHTML;
            }

            caption.addEventListener('touchstart', function(event) {
                event.stopPropagation();
            });

            return caption;
        }

        // make carbon copy of html dom element
        function makeCopy(source) {
            const sourceCopy = source.cloneNode(true);

            // delete elements marked with ignore (eg anchor and jump buttons)
            const deleteFromCopy = sourceCopy.querySelectorAll(
                '[data-ignore="true"]'
            );
            for (const element of deleteFromCopy)
                element.remove();

            // delete certain element attributes
            const attributes = [
                'id',
                'data-collapsed',
                'data-selected',
                'data-highlighted',
                'data-glow'
            ];
            for (const attribute of attributes) {
                sourceCopy.removeAttribute(attribute);
                const elements = sourceCopy.querySelectorAll(
                    '[' + attribute + ']'
                );
                for (const element of elements)
                    element.removeAttribute(attribute);
            }

            return sourceCopy;
        }

        // make button to jump to previous image in document
        function makePrevButton(img) {
            const prevButton = document.createElement('button');
            prevButton.id = 'lightbox_prev_button';
            prevButton.title = 'Jump to the previous image in the document [←]';
            prevButton.classList.add('icon_button', 'lightbox_button');
            prevButton.innerHTML = document.querySelector(
                '.icon_caret_left'
            ).innerHTML;

            // attach click listeners to button
            prevButton.addEventListener('click', function() {
                getPrevImg(img).click();
            });

            return prevButton;
        }

        // make button to jump to next image in document
        function makeNextButton(img) {
            const nextButton = document.createElement('button');
            nextButton.id = 'lightbox_next_button';
            nextButton.title = 'Jump to the next image in the document [→]';
            nextButton.classList.add('icon_button', 'lightbox_button');
            nextButton.innerHTML = document.querySelector(
                '.icon_caret_right'
            ).innerHTML;

            // attach click listeners to button
            nextButton.addEventListener('click', function() {
                getNextImg(img).click();
            });

            return nextButton;
        }

        // get previous image in document
        function getPrevImg(img) {
            const imgs = document.querySelectorAll('.lightbox_document_img');

            // find index of provided img
            let index;
            for (index = 0; index < imgs.length; index++) {
                if (imgs[index] === img)
                    break;
            }


            // wrap index to other side if < 1
            if (index - 1 >= 0)
                index--;
            else
                index = imgs.length - 1;
            return imgs[index];
        }

        // get next image in document
        function getNextImg(img) {
            const imgs = document.querySelectorAll('.lightbox_document_img');

            // find index of provided img
            let index;
            for (index = 0; index < imgs.length; index++) {
                if (imgs[index] === img)
                    break;
            }


            // wrap index to other side if > total
            if (index + 1 <= imgs.length - 1)
                index++;
            else
                index = 0;
            return imgs[index];
        }

        // close lightbox
        function closeLightbox() {
            focusBody();

            const lightbox = document.getElementById('lightbox_overlay');
            if (lightbox)
                lightbox.remove();
        }

        // make all elements behind lightbox non-focusable
        function blurBody(overlay) {
            const all = document.querySelectorAll('*');
            for (const element of all)
                element.tabIndex = -1;
            document.body.classList.add('body_no_scroll');
        }

        // make all elements focusable again
        function focusBody() {
            const all = document.querySelectorAll('*');
            for (const element of all)
                element.removeAttribute('tabIndex');
            document.body.classList.remove('body_no_scroll');
        }

        // load options from url parameters
        function loadOptions() {
            const url = window.location.search;
            const params = new URLSearchParams(url);
            for (const optionName of Object.keys(options)) {
                const paramName = pluginName + '-' + optionName;
                const param = params.get(paramName);
                if (param !== '' && param !== null)
                    options[optionName] = param;
            }
        }
        loadOptions();

        // start script when document is finished loading
        if (options.enabled === 'true')
            window.addEventListener('load', start);
    })();
</script>

<!-- caret left icon -->

<template class="icon_caret_left">
    <!-- modified from: https://fontawesome.com/icons/caret-left -->
    <svg width="16" height="16" viewBox="0 0 192 512">
        <path
            fill="currentColor"
            d="M192 127.338v257.324c0 17.818-21.543 26.741-34.142 14.142L29.196 270.142c-7.81-7.81-7.81-20.474 0-28.284l128.662-128.662c12.599-12.6 34.142-3.676 34.142 14.142z"
        ></path>
    </svg>
</template>

<!-- caret right icon -->

<template class="icon_caret_right">
    <!-- modified from: https://fontawesome.com/icons/caret-right -->
    <svg width="16" height="16" viewBox="0 0 192 512">
        <path
            fill="currentColor"
            d="M0 384.662V127.338c0-17.818 21.543-26.741 34.142-14.142l128.662 128.662c7.81 7.81 7.81 20.474 0 28.284L34.142 398.804C21.543 411.404 0 402.48 0 384.662z"
        ></path>
    </svg>
</template>
<!-- attributes plugin -->

<script>
    (function() {
        // /////////////////////////
        // DESCRIPTION
        // /////////////////////////

        // This Manubot plugin allows arbitrary HTML attributes to be attached
        // to (almost) any element. Place an HTML comment inside or next to the
        // desired element in the format <!-- $attribute="value" -->

        // /////////////////////////
        // OPTIONS
        // /////////////////////////

        // plugin name prefix for url parameters
        const pluginName = 'attributes';

        // default plugin options
        const options = {
            // whether plugin is on or not
            enabled: 'true'
        };

        // change options above, or override with url parameter, eg:
        // 'manuscript.html?pluginName-enabled=false'

        // /////////////////////////
        // SCRIPT
        // /////////////////////////

        // start script
        function start() {
            // get list of comments in document
            const comments = findComments();

            for(const comment of comments)
                if (comment.parentElement)
                    addAttributes(
                        comment.parentElement,
                        comment.nodeValue.trim()
                    );
        }

        // add html attributes to specified element based on string of 
        // html attributes and values
        function addAttributes(element, text) {
            // regex's for finding attribute/value pairs in the format of
            // attribute="value" or attribute='value
            const regex2 = /\$([a-zA-Z\-]+)?=\"(.+?)\"/;
            const regex1 = /\$([a-zA-Z\-]+)?=\'(.+?)\'/;

            // loop through attribute/value pairs
            let match;
            while(match = text.match(regex2) || text.match(regex1)) {
                // get attribute and value from regex capture groups
                let attribute = match[1];
                let value = match[2];

                // remove from string
                text = text.substring(match.index + match[0].length);

                if (!attribute || !value)
                    break;

                // set attribute of parent element
                try {
                    element.setAttribute(attribute, value);
                } catch(error) {
                    console.log(error);
                }

                // special case for colspan
                if (attribute === 'colspan')
                    removeTableCells(element, value);
            }
        }

        // get list of comment elements in document
        function findComments() {
            const comments = [];

            // iterate over comment nodes in document
            function acceptNode(node) {
                return NodeFilter.FILTER_ACCEPT;
            }
            const iterator = document.createNodeIterator(
                document.body,
                NodeFilter.SHOW_COMMENT,
                acceptNode
            );
            let node;
            while(node = iterator.nextNode())
                comments.push(node);

            return comments;
        }

        // remove certain number of cells after specified cell
        function removeTableCells(cell, number) {
            number = parseInt(number);
            if (!number)
                return;

            // remove elements
            for(; number > 1; number--) {
                if (cell.nextElementSibling)
                    cell.nextElementSibling.remove();
            }
        }

        // load options from url parameters
        function loadOptions() {
            const url = window.location.search;
            const params = new URLSearchParams(url);
            for (const optionName of Object.keys(options)) {
                const paramName = pluginName + '-' + optionName;
                const param = params.get(paramName);
                if (param !== '' && param !== null)
                    options[optionName] = param;
            }
        }
        loadOptions();

        // start script when document is finished loading
        if (options.enabled === 'true')
            window.addEventListener('load', start);
    })();
</script>
<!-- mathjax plugin configuration -->

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        "CommonHTML": { linebreaks: { automatic: true } },
        "HTML-CSS": { linebreaks: { automatic: true } },
        "SVG": { linebreaks: { automatic: true } },
        "fast-preview": { disabled: true }
  });
</script>

<!-- mathjax plugin -->

<script
    src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"
    integrity="sha512-0doc9hKxR3PYwso42RD1p5ySZpzzuDiOwMrdCEh2WdJZCjcmFKc/wEnL+z8fBQrnHoiNWbo+3fiGkOYXBdQp4A=="
    crossorigin="anonymous"
>
    // /////////////////////////
    // DESCRIPTION
    // /////////////////////////

    // This third-party plugin 'MathJax' allows the proper rendering of
    // math/equations written in LaTeX.

    // https://www.mathjax.org/
</script>
<!-- annotations plugin -->

<script>
    // /////////////////////////
    // DESCRIPTION
    // /////////////////////////

    // This third-party plugin 'Hypothesis' allows public annotation of the
    // manuscript.

    // https://web.hypothes.is/

    // plugin configuration
    window.hypothesisConfig = function() {
        return {
            branding: {
                accentColor: '#2196f3',
                appBackgroundColor: '#f8f8f8',
                ctaBackgroundColor: '#f8f8f8',
                ctaTextColor: '#000000',
                selectionFontFamily: 'Open Sans, Helvetica, sans serif',
                annotationFontFamily: 'Open Sans, Helvetica, sans serif'
            }
        };
    };

    // hypothesis client script
    const embed = 'https://hypothes.is/embed.js';
    // hypothesis annotation count query url
    const query = 'https://api.hypothes.is/api/search?limit=0&url='

    
    // start script
    function start() {
        const button = makeButton();
        document.body.insertBefore(button, document.body.firstChild);
        insertCount(button);
    }

    // make button
    function makeButton() {
        // create button
        const button = document.createElement('button');
        button.id = 'hypothesis_button';
        button.innerHTML = document.querySelector('.icon_hypothesis').innerHTML;
        button.title = 'Hypothesis annotations';
        button.classList.add('icon_button');

        function onClick(event) {
            onButtonClick(event, button);
        }

        // attach click listeners
        button.addEventListener('click', onClick);

        return button;
    }

    // insert annotations count
    async function insertCount(button) {
        // get annotation count from Hypothesis based on url
        let count = '-';
        try {
            const canonical = document.querySelector('link[rel="canonical"]');
            const location = window.location;
            const url = encodeURIComponent((canonical || location).href);
            const response = await fetch(query + url);
            const json = await response.json();
            count = json.total || '-';
        } catch(error) {
            console.log(error);
        }
        
        // put count into button
        const counter = document.createElement('span');
        counter.id = 'hypothesis_count';
        counter.innerHTML = count;
        button.title = 'View ' + count + ' Hypothesis annotations';
        button.append(counter);
    }

    // when button is clicked
    function onButtonClick(event, button) {
        const script = document.createElement('script');
        script.src = embed;
        document.body.append(script);
        button.remove();
    }

    window.addEventListener('load', start);
</script>

<!-- hypothesis icon -->

<template class="icon_hypothesis">
    <!-- modified from: https://simpleicons.org/icons/hypothesis.svg / https://git.io/Jf1VB -->
    <svg width="16" height="16" viewBox="0 0 24 24" tabindex="-1">
        <path
            fill="currentColor"
            d="M3.43 0C2.5 0 1.72 .768 1.72 1.72V18.86C1.72 19.8 2.5 20.57 3.43 20.57H9.38L12 24L14.62 20.57H20.57C21.5 20.57 22.29 19.8 22.29 18.86V1.72C22.29 .77 21.5 0 20.57 0H3.43M5.14 3.43H7.72V9.43S8.58 7.72 10.28 7.72C12 7.72 13.74 8.57 13.74 11.24V17.14H11.16V12C11.16 10.61 10.28 10.07 9.43 10.29C8.57 10.5 7.72 11.41 7.72 13.29V17.14H5.14V3.43M18 13.72C18.95 13.72 19.72 14.5 19.72 15.42A1.71 1.71 0 0 1 18 17.13A1.71 1.71 0 0 1 16.29 15.42C16.29 14.5 17.05 13.71 18 13.71Z"
            tabindex="-1"
        ></path>
    </svg>
</template>
<!-- analytics plugin -->

<!-- copy and paste code from Google Analytics or similar service here -->
</body>
</html>
